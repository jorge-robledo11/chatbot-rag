2025-07-31 17:43:28|INFO    |262774|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-07-31 17:43:28|DEBUG   |262774|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-07-31 17:43:28|INFO    |262774|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:43:28|INFO    |262774|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-07-31 17:43:28|INFO    |262774|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-07-31 17:43:28|INFO    |262774|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:74|Registrando middleware CORS.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:82|Middleware CORS registrado.
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:87|Incluyendo routers.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-07-31 17:43:28|INFO    |262774|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-07-31 17:43:28|INFO    |262774|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:43:28|INFO    |262774|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: initialize_agent
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: initialize_agent
2025-07-31 17:43:28|INFO    |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:48|üîß Creando instancia del agente...
2025-07-31 17:43:28|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:57|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index, web=web-index)
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: openai_create_factory
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: openai_create_factory
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.openai.create:73|üîß Iniciando OpenAI.create()
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.openai._ensure_settings:61|üîç Validando configuraci√≥n de OpenAI
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.openai.create:79|üîë Configuraci√≥n de API key y endpoint encontrada
2025-07-31 17:43:28|SUCCESS |262774|backend.src.infrastructure.openai.create:88|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.openai.__init__:46|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-07-31 17:43:28|INFO    |262774|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.openai.__init__:55|‚úÖ Servicio OpenAI inicializado correctamente
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[openai_create_factory] M√©tricas recogidas: tiempo=0.0240s, cpu=0.00%, memoria_actual=159.09MB, memoria_pico=157.33MB, llamadas=30769
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/openai_create_factory.json
2025-07-31 17:43:28|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: openai_create_factory. Tiempo: 0.024s, Memoria pico: 157.33MB, Llamadas: 30769
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: searchai_create_factory
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: searchai_create_factory
2025-07-31 17:43:28|SUCCESS |262774|backend.src.infrastructure.searchai.create:79|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index'.
2025-07-31 17:43:28|DEBUG   |262774|backend.src.infrastructure.searchai.__init__:57|Clientes de Search AI para √≠ndice 'pdf-index' asignados.
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[searchai_create_factory] M√©tricas recogidas: tiempo=0.0011s, cpu=0.00%, memoria_actual=159.09MB, memoria_pico=159.09MB, llamadas=1092
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/searchai_create_factory.json
2025-07-31 17:43:28|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: searchai_create_factory. Tiempo: 0.001s, Memoria pico: 159.09MB, Llamadas: 1092
2025-07-31 17:43:28|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:62|‚úÖ SearchAI listos (PDF='pdf-index', WEB='web-index')
2025-07-31 17:43:28|INFO    |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:66|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-07-31 17:43:28|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:75|‚úÖ Modelo AzureChatOpenAI listo.
2025-07-31 17:43:28|INFO    |262774|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-07-31 17:43:28|SUCCESS |262774|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-07-31 17:43:28|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:85|üöÄ Agente listo para solicitudes.
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[initialize_agent] M√©tricas recogidas: tiempo=0.1017s, cpu=0.00%, memoria_actual=164.75MB, memoria_pico=157.25MB, llamadas=1163
2025-07-31 17:43:28|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/initialize_agent.json
2025-07-31 17:43:28|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: initialize_agent. Tiempo: 0.102s, Memoria pico: 157.25MB, Llamadas: 1163
2025-07-31 17:43:28|INFO    |262774|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-07-31 17:43:28|INFO    |262774|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-07-31 17:43:39|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:43:39|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/favicon.ico
2025-07-31 17:43:39|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /favicon.ico
2025-07-31 17:43:39|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 404 (tard√≥ 0.38ms)
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_scalar_docs
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_scalar_docs
2025-07-31 17:43:47|INFO    |262774|backend.src.routers.meta.get_scalar_docs:90|‚Üí Llamada a get_scalar_docs
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[get_scalar_docs] M√©tricas recogidas: tiempo=0.0011s, cpu=0.00%, memoria_actual=165.10MB, memoria_pico=165.02MB, llamadas=258
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_scalar_docs.json
2025-07-31 17:43:47|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_scalar_docs. Tiempo: 0.001s, Memoria pico: 165.02MB, Llamadas: 258
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2.21ms)
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-07-31 17:43:47|INFO    |262774|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.54ms)
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:43:47|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-07-31 17:43:47|DEBUG   |262774|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-07-31 17:43:47|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.47ms)
2025-07-31 17:43:59|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:43:59|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-07-31 17:43:59|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-07-31 17:43:59|WARNING |262774|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-07-31 17:43:59|INFO    |262774|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: initialize_agent
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: initialize_agent
2025-07-31 17:43:59|INFO    |262774|backend.src.orchestrator.settings.agent_factory.initialize_agent:45|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[initialize_agent] M√©tricas recogidas: tiempo=0.0008s, cpu=0.00%, memoria_actual=165.50MB, memoria_pico=165.48MB, llamadas=230
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/initialize_agent.json
2025-07-31 17:43:59|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: initialize_agent. Tiempo: 0.001s, Memoria pico: 165.48MB, Llamadas: 230
2025-07-31 17:43:59|INFO    |262774|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_create_factory
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_create_factory
2025-07-31 17:43:59|SUCCESS |262774|backend.src.infrastructure.cosmos_db_sessions.create:106|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_create_factory] M√©tricas recogidas: tiempo=0.0604s, cpu=0.00%, memoria_actual=167.23MB, memoria_pico=165.50MB, llamadas=2799
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_create_factory.json
2025-07-31 17:43:59|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_create_factory. Tiempo: 0.060s, Memoria pico: 165.50MB, Llamadas: 2799
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_users_create_factory
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_users_create_factory
2025-07-31 17:43:59|SUCCESS |262774|backend.src.infrastructure.cosmos_db_users.create:99|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_users_create_factory] M√©tricas recogidas: tiempo=0.0139s, cpu=0.00%, memoria_actual=168.05MB, memoria_pico=167.23MB, llamadas=2178
2025-07-31 17:43:59|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_users_create_factory.json
2025-07-31 17:43:59|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_users_create_factory. Tiempo: 0.014s, Memoria pico: 167.23MB, Llamadas: 2178
2025-07-31 17:43:59|DEBUG   |262774|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-07-31 17:44:00|INFO    |262774|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-07-31 17:44:00|SUCCESS |262774|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-07-31 17:44:00|DEBUG   |262774|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-07-31 17:44:00|SUCCESS |262774|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-07-31 17:44:00|SUCCESS |262774|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-07-31 17:44:00|DEBUG   |262774|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:44:00|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: process_user_query
2025-07-31 17:44:00|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: process_user_query
2025-07-31 17:44:00|INFO    |262774|backend.src.routers.chat.process_user_query:56|üì© Recibida nueva consulta al chat.
2025-07-31 17:44:00|DEBUG   |262774|backend.src.routers.chat.process_user_query:57|Payload recibido: session_id='', query='Hola ¬øC√≥mo est√°s?'
2025-07-31 17:44:00|INFO    |262774|backend.src.routers.chat.process_user_query:75|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-07-31 17:44:00|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_create_session
2025-07-31 17:44:00|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_create_session
2025-07-31 17:44:02|SUCCESS |262774|backend.src.infrastructure.cosmos_db_sessions.create_session:154|üÜï Sesi√≥n creada id=sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_create_session] M√©tricas recogidas: tiempo=2.0297s, cpu=0.00%, memoria_actual=170.30MB, memoria_pico=169.29MB, llamadas=474
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_create_session.json
2025-07-31 17:44:02|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_create_session. Tiempo: 2.030s, Memoria pico: 169.29MB, Llamadas: 474
2025-07-31 17:44:02|SUCCESS |262774|backend.src.routers.chat.process_user_query:77|‚ú® Nueva sesi√≥n creada: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:02|DEBUG   |262774|backend.src.routers.chat.process_user_query:87|Invocando agente para sesi√≥n: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: invoke_agent
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: invoke_agent
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_persistent_chat_history
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_persistent_chat_history
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:44:02|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:02.455882-05:00
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0907s, cpu=0.00%, memoria_actual=170.42MB, memoria_pico=170.31MB, llamadas=593
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:44:02|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.091s, Memoria pico: 170.31MB, Llamadas: 593
2025-07-31 17:44:02|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:126|Historial vac√≠o para session_id=sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[get_persistent_chat_history] M√©tricas recogidas: tiempo=0.0922s, cpu=0.00%, memoria_actual=170.43MB, memoria_pico=170.30MB, llamadas=531
2025-07-31 17:44:02|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_persistent_chat_history.json
2025-07-31 17:44:02|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_persistent_chat_history. Tiempo: 0.092s, Memoria pico: 170.30MB, Llamadas: 531
2025-07-31 17:44:03|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.9090s, cpu=0.00%, memoria_actual=170.45MB, memoria_pico=170.31MB, llamadas=447
2025-07-31 17:44:03|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:44:03|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.909s, Memoria pico: 170.31MB, Llamadas: 447
2025-07-31 17:44:03|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:182|üìö Historial para grafo (0 mensajes)
2025-07-31 17:44:03|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:189|‚ñ∂Ô∏è Invocando grafo con consulta: 'Hola ¬øC√≥mo est√°s?‚Ä¶'
2025-07-31 17:44:03|INFO    |262774|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:44:04|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:195|‚úîÔ∏è Respuesta: '¬°Hola! Estoy aqu√≠ para ayudarte con cualquier cons‚Ä¶'
2025-07-31 17:44:04|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:198|üìö Fuentes extra√≠das (controlado por backend): []
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[invoke_agent] M√©tricas recogidas: tiempo=1.8804s, cpu=0.00%, memoria_actual=170.93MB, memoria_pico=170.30MB, llamadas=608
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/invoke_agent.json
2025-07-31 17:44:04|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: invoke_agent. Tiempo: 1.880s, Memoria pico: 170.30MB, Llamadas: 608
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:44:04|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:04.336161-05:00
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0892s, cpu=0.00%, memoria_actual=170.99MB, memoria_pico=170.93MB, llamadas=603
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:44:04|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.089s, Memoria pico: 170.93MB, Llamadas: 603
2025-07-31 17:44:04|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:04.424847-05:00
2025-07-31 17:44:04|SUCCESS |262774|backend.src.routers.chat.process_user_query:113|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[process_user_query] M√©tricas recogidas: tiempo=4.0041s, cpu=0.00%, memoria_actual=170.99MB, memoria_pico=169.27MB, llamadas=1218
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/process_user_query.json
2025-07-31 17:44:04|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: process_user_query. Tiempo: 4.004s, Memoria pico: 169.27MB, Llamadas: 1218
2025-07-31 17:44:04|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4628.55ms)
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0913s, cpu=0.00%, memoria_actual=170.99MB, memoria_pico=170.93MB, llamadas=412
2025-07-31 17:44:04|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:44:04|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.091s, Memoria pico: 170.93MB, Llamadas: 412
2025-07-31 17:44:31|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:44:31|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-07-31 17:44:31|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: process_user_query
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: process_user_query
2025-07-31 17:44:31|INFO    |262774|backend.src.routers.chat.process_user_query:56|üì© Recibida nueva consulta al chat.
2025-07-31 17:44:31|DEBUG   |262774|backend.src.routers.chat.process_user_query:57|Payload recibido: session_id='sess_3cd99028e354bd7d7a3944012da03653', query='Me llamo Jorge. ¬øPuedes decirme detalles de tejas de polipropileno?'
2025-07-31 17:44:31|DEBUG   |262774|backend.src.routers.chat.process_user_query:71|Buscando sesi√≥n existente: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.1010s, cpu=0.00%, memoria_actual=170.99MB, memoria_pico=170.99MB, llamadas=200
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:44:31|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.101s, Memoria pico: 170.99MB, Llamadas: 200
2025-07-31 17:44:31|DEBUG   |262774|backend.src.routers.chat.process_user_query:87|Invocando agente para sesi√≥n: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: invoke_agent
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: invoke_agent
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_persistent_chat_history
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_persistent_chat_history
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:44:31|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:31.595988-05:00
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0892s, cpu=0.00%, memoria_actual=171.07MB, memoria_pico=170.99MB, llamadas=595
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:44:31|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.089s, Memoria pico: 170.99MB, Llamadas: 595
2025-07-31 17:44:31|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:143|üìú Historial convertido (2 mensajes)
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[get_persistent_chat_history] M√©tricas recogidas: tiempo=0.0920s, cpu=0.00%, memoria_actual=171.07MB, memoria_pico=170.99MB, llamadas=531
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_persistent_chat_history.json
2025-07-31 17:44:31|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_persistent_chat_history. Tiempo: 0.092s, Memoria pico: 170.99MB, Llamadas: 531
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0916s, cpu=0.00%, memoria_actual=171.07MB, memoria_pico=171.00MB, llamadas=406
2025-07-31 17:44:31|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:44:31|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.092s, Memoria pico: 171.00MB, Llamadas: 406
2025-07-31 17:44:31|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:182|üìö Historial para grafo (2 mensajes)
2025-07-31 17:44:31|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:189|‚ñ∂Ô∏è Invocando grafo con consulta: 'Me llamo Jorge. ¬øPuedes decirme detalles de tejas ‚Ä¶'
2025-07-31 17:44:31|INFO    |262774|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:44:33|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:195|‚úîÔ∏è Respuesta: '¬°Claro que s√≠, Jorge! Con gusto te proporciono la ‚Ä¶'
2025-07-31 17:44:33|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:198|üìö Fuentes extra√≠das (controlado por backend): []
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[invoke_agent] M√©tricas recogidas: tiempo=1.4405s, cpu=0.00%, memoria_actual=171.14MB, memoria_pico=170.99MB, llamadas=608
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/invoke_agent.json
2025-07-31 17:44:33|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: invoke_agent. Tiempo: 1.441s, Memoria pico: 170.99MB, Llamadas: 608
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:44:33|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:33.035731-05:00
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0892s, cpu=0.00%, memoria_actual=171.14MB, memoria_pico=171.14MB, llamadas=603
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:44:33|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.089s, Memoria pico: 171.14MB, Llamadas: 603
2025-07-31 17:44:33|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:44:33.124477-05:00
2025-07-31 17:44:33|SUCCESS |262774|backend.src.routers.chat.process_user_query:113|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[process_user_query] M√©tricas recogidas: tiempo=1.6348s, cpu=0.00%, memoria_actual=171.14MB, memoria_pico=170.99MB, llamadas=1201
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/process_user_query.json
2025-07-31 17:44:33|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: process_user_query. Tiempo: 1.635s, Memoria pico: 170.99MB, Llamadas: 1201
2025-07-31 17:44:33|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1636.50ms)
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.1059s, cpu=0.00%, memoria_actual=171.14MB, memoria_pico=171.14MB, llamadas=416
2025-07-31 17:44:33|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:44:33|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.106s, Memoria pico: 171.14MB, Llamadas: 416
2025-07-31 17:46:09|INFO    |262774|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:46:09|INFO    |262774|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-07-31 17:46:09|INFO    |262774|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: process_user_query
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: process_user_query
2025-07-31 17:46:09|INFO    |262774|backend.src.routers.chat.process_user_query:56|üì© Recibida nueva consulta al chat.
2025-07-31 17:46:09|DEBUG   |262774|backend.src.routers.chat.process_user_query:57|Payload recibido: session_id='sess_3cd99028e354bd7d7a3944012da03653', query='S√≠, me refiero a tejas de polipropileno'
2025-07-31 17:46:09|DEBUG   |262774|backend.src.routers.chat.process_user_query:71|Buscando sesi√≥n existente: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0895s, cpu=0.00%, memoria_actual=171.15MB, memoria_pico=171.14MB, llamadas=199
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:46:09|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.089s, Memoria pico: 171.14MB, Llamadas: 199
2025-07-31 17:46:09|DEBUG   |262774|backend.src.routers.chat.process_user_query:87|Invocando agente para sesi√≥n: sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: invoke_agent
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: invoke_agent
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_persistent_chat_history
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_persistent_chat_history
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:46:09|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:46:09.534332-05:00
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0902s, cpu=0.00%, memoria_actual=171.19MB, memoria_pico=171.15MB, llamadas=593
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:46:09|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.090s, Memoria pico: 171.15MB, Llamadas: 593
2025-07-31 17:46:09|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:143|üìú Historial convertido (4 mensajes)
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[get_persistent_chat_history] M√©tricas recogidas: tiempo=0.0920s, cpu=0.00%, memoria_actual=171.19MB, memoria_pico=171.15MB, llamadas=531
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_persistent_chat_history.json
2025-07-31 17:46:09|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_persistent_chat_history. Tiempo: 0.092s, Memoria pico: 171.15MB, Llamadas: 531
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0926s, cpu=0.00%, memoria_actual=171.20MB, memoria_pico=171.15MB, llamadas=403
2025-07-31 17:46:09|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:46:09|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.093s, Memoria pico: 171.15MB, Llamadas: 403
2025-07-31 17:46:09|DEBUG   |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:182|üìö Historial para grafo (4 mensajes)
2025-07-31 17:46:09|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:189|‚ñ∂Ô∏è Invocando grafo con consulta: 'S√≠, me refiero a tejas de polipropileno‚Ä¶'
2025-07-31 17:46:09|INFO    |262774|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:46:10|DEBUG   |262774|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-07-31 17:46:10|DEBUG   |262774|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Tejas de Polipropileno'
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: searchai_hybrid_search
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: searchai_hybrid_search
2025-07-31 17:46:10|INFO    |262774|backend.src.infrastructure.searchai.hybrid_search:167|üîéü§ñ B√∫squeda h√≠brida: 'Tejas de Polipropileno...' (top_k=10)
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: openai_get_text_embedding
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: openai_get_text_embedding
2025-07-31 17:46:10|DEBUG   |262774|backend.src.infrastructure.openai.get_text_embedding:201|üìä Generando embedding para texto (len=22)
2025-07-31 17:46:10|DEBUG   |262774|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+162.32 en 162.32s)
2025-07-31 17:46:10|DEBUG   |262774|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-07-31 17:46:10|DEBUG   |262774|backend.src.infrastructure.openai.client:105|üîç Accediendo a cliente de OpenAI
2025-07-31 17:46:10|INFO    |262774|backend.src.infrastructure.openai.get_text_embedding:211|‚úÖ Embedding generado (dim=1536)
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[openai_get_text_embedding] M√©tricas recogidas: tiempo=0.4536s, cpu=0.00%, memoria_actual=188.82MB, memoria_pico=171.21MB, llamadas=89889
2025-07-31 17:46:10|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/openai_get_text_embedding.json
2025-07-31 17:46:10|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: openai_get_text_embedding. Tiempo: 0.454s, Memoria pico: 171.21MB, Llamadas: 89889
2025-07-31 17:46:11|ERROR   |262774|backend.src.infrastructure.searchai.hybrid_search:187|‚ùå Error en b√∫squeda: () Invalid expression: Could not find a property named 'parent_document_id' on type 'search.document'.
Parameter name: $select
Code: 
Message: Invalid expression: Could not find a property named 'parent_document_id' on type 'search.document'.
Parameter name: $select
2025-07-31 17:46:11|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[searchai_hybrid_search] M√©tricas recogidas: tiempo=1.0877s, cpu=0.00%, memoria_actual=188.99MB, memoria_pico=171.21MB, llamadas=751
2025-07-31 17:46:11|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/searchai_hybrid_search.json
2025-07-31 17:46:11|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: searchai_hybrid_search. Tiempo: 1.088s, Memoria pico: 171.21MB, Llamadas: 751
2025-07-31 17:46:11|SUCCESS |262774|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 0
2025-07-31 17:46:11|DEBUG   |262774|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: []...
2025-07-31 17:46:11|INFO    |262774|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): []
2025-07-31 17:46:11|INFO    |262774|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:46:12|SUCCESS |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:195|‚úîÔ∏è Respuesta: 'Jorge, no encontr√© informaci√≥n espec√≠fica sobre la‚Ä¶'
2025-07-31 17:46:12|INFO    |262774|backend.src.orchestrator.settings.agent_factory.invoke_agent:198|üìö Fuentes extra√≠das (controlado por backend): []
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[invoke_agent] M√©tricas recogidas: tiempo=2.7663s, cpu=0.00%, memoria_actual=189.00MB, memoria_pico=171.15MB, llamadas=608
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/invoke_agent.json
2025-07-31 17:46:12|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: invoke_agent. Tiempo: 2.766s, Memoria pico: 171.15MB, Llamadas: 608
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:46:12|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:46:12.300300-05:00
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0932s, cpu=0.00%, memoria_actual=189.00MB, memoria_pico=189.00MB, llamadas=413
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:46:12|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.093s, Memoria pico: 189.00MB, Llamadas: 413
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.1220s, cpu=0.00%, memoria_actual=189.00MB, memoria_pico=189.00MB, llamadas=603
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:46:12|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.122s, Memoria pico: 189.00MB, Llamadas: 603
2025-07-31 17:46:12|DEBUG   |262774|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:46:12.421642-05:00
2025-07-31 17:46:12|SUCCESS |262774|backend.src.routers.chat.process_user_query:113|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3cd99028e354bd7d7a3944012da03653
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._collect_metrics:211|[process_user_query] M√©tricas recogidas: tiempo=2.9816s, cpu=0.00%, memoria_actual=189.00MB, memoria_pico=171.14MB, llamadas=1201
2025-07-31 17:46:12|DEBUG   |262774|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/process_user_query.json
2025-07-31 17:46:12|INFO    |262774|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: process_user_query. Tiempo: 2.982s, Memoria pico: 171.14MB, Llamadas: 1201
2025-07-31 17:46:12|INFO    |262774|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2983.30ms)
2025-07-31 17:50:55|INFO    |265884|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-07-31 17:50:55|DEBUG   |265884|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-07-31 17:50:55|INFO    |265884|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:50:55|INFO    |265884|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-07-31 17:50:55|INFO    |265884|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-07-31 17:50:55|INFO    |265884|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:74|Registrando middleware CORS.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:82|Middleware CORS registrado.
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:87|Incluyendo routers.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-07-31 17:50:55|INFO    |265884|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-07-31 17:50:55|INFO    |265884|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-07-31 17:50:55|INFO    |265884|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: initialize_agent
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: initialize_agent
2025-07-31 17:50:55|INFO    |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:48|üîß Creando instancia del agente...
2025-07-31 17:50:55|DEBUG   |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:57|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index)
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: openai_create_factory
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: openai_create_factory
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.openai.create:73|üîß Iniciando OpenAI.create()
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.openai._ensure_settings:61|üîç Validando configuraci√≥n de OpenAI
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.openai.create:79|üîë Configuraci√≥n de API key y endpoint encontrada
2025-07-31 17:50:55|SUCCESS |265884|backend.src.infrastructure.openai.create:88|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.openai.__init__:46|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-07-31 17:50:55|INFO    |265884|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.openai.__init__:55|‚úÖ Servicio OpenAI inicializado correctamente
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[openai_create_factory] M√©tricas recogidas: tiempo=0.0229s, cpu=0.00%, memoria_actual=156.26MB, memoria_pico=153.12MB, llamadas=30769
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/openai_create_factory.json
2025-07-31 17:50:55|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: openai_create_factory. Tiempo: 0.023s, Memoria pico: 153.12MB, Llamadas: 30769
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: searchai_create_factory
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: searchai_create_factory
2025-07-31 17:50:55|SUCCESS |265884|backend.src.infrastructure.searchai.create:79|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-07-31 17:50:55|DEBUG   |265884|backend.src.infrastructure.searchai.__init__:57|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[searchai_create_factory] M√©tricas recogidas: tiempo=0.0012s, cpu=0.00%, memoria_actual=156.26MB, memoria_pico=156.26MB, llamadas=1092
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/searchai_create_factory.json
2025-07-31 17:50:55|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: searchai_create_factory. Tiempo: 0.001s, Memoria pico: 156.26MB, Llamadas: 1092
2025-07-31 17:50:55|SUCCESS |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:62|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index')
2025-07-31 17:50:55|INFO    |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:66|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-07-31 17:50:55|SUCCESS |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:75|‚úÖ Modelo AzureChatOpenAI listo.
2025-07-31 17:50:55|INFO    |265884|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-07-31 17:50:55|SUCCESS |265884|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-07-31 17:50:55|SUCCESS |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:85|üöÄ Agente listo para solicitudes.
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[initialize_agent] M√©tricas recogidas: tiempo=0.0977s, cpu=0.00%, memoria_actual=164.02MB, memoria_pico=153.04MB, llamadas=1163
2025-07-31 17:50:55|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/initialize_agent.json
2025-07-31 17:50:55|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: initialize_agent. Tiempo: 0.098s, Memoria pico: 153.04MB, Llamadas: 1163
2025-07-31 17:50:55|INFO    |265884|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-07-31 17:50:55|INFO    |265884|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_scalar_docs
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_scalar_docs
2025-07-31 17:50:58|INFO    |265884|backend.src.routers.meta.get_scalar_docs:90|‚Üí Llamada a get_scalar_docs
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[get_scalar_docs] M√©tricas recogidas: tiempo=0.0011s, cpu=0.00%, memoria_actual=164.31MB, memoria_pico=164.23MB, llamadas=260
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_scalar_docs.json
2025-07-31 17:50:58|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_scalar_docs. Tiempo: 0.001s, Memoria pico: 164.23MB, Llamadas: 260
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2.34ms)
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-07-31 17:50:58|INFO    |265884|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.82ms)
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:50:58|INFO    |265884|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-07-31 17:50:58|DEBUG   |265884|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-07-31 17:50:58|INFO    |265884|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.49ms)
2025-07-31 17:51:07|INFO    |265884|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:51:07|INFO    |265884|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-07-31 17:51:07|INFO    |265884|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-07-31 17:51:07|WARNING |265884|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-07-31 17:51:07|INFO    |265884|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: initialize_agent
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: initialize_agent
2025-07-31 17:51:07|INFO    |265884|backend.src.orchestrator.settings.agent_factory.initialize_agent:45|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[initialize_agent] M√©tricas recogidas: tiempo=0.0010s, cpu=0.00%, memoria_actual=164.74MB, memoria_pico=164.70MB, llamadas=230
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/initialize_agent.json
2025-07-31 17:51:07|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: initialize_agent. Tiempo: 0.001s, Memoria pico: 164.70MB, Llamadas: 230
2025-07-31 17:51:07|INFO    |265884|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_create_factory
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_create_factory
2025-07-31 17:51:07|SUCCESS |265884|backend.src.infrastructure.cosmos_db_sessions.create:106|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_create_factory] M√©tricas recogidas: tiempo=0.0154s, cpu=0.00%, memoria_actual=166.55MB, memoria_pico=164.74MB, llamadas=2799
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_create_factory.json
2025-07-31 17:51:07|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_create_factory. Tiempo: 0.015s, Memoria pico: 164.74MB, Llamadas: 2799
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_users_create_factory
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_users_create_factory
2025-07-31 17:51:07|SUCCESS |265884|backend.src.infrastructure.cosmos_db_users.create:99|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_users_create_factory] M√©tricas recogidas: tiempo=0.0591s, cpu=0.00%, memoria_actual=167.39MB, memoria_pico=166.55MB, llamadas=2178
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_users_create_factory.json
2025-07-31 17:51:07|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_users_create_factory. Tiempo: 0.059s, Memoria pico: 166.55MB, Llamadas: 2178
2025-07-31 17:51:07|DEBUG   |265884|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-07-31 17:51:07|INFO    |265884|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-07-31 17:51:07|SUCCESS |265884|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-07-31 17:51:07|DEBUG   |265884|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-07-31 17:51:07|SUCCESS |265884|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-07-31 17:51:07|SUCCESS |265884|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: process_user_query
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: process_user_query
2025-07-31 17:51:07|INFO    |265884|backend.src.routers.chat.process_user_query:56|üì© Recibida nueva consulta al chat.
2025-07-31 17:51:07|DEBUG   |265884|backend.src.routers.chat.process_user_query:57|Payload recibido: session_id='', query='Hola me llamo Jorge'
2025-07-31 17:51:07|INFO    |265884|backend.src.routers.chat.process_user_query:75|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_create_session
2025-07-31 17:51:07|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_create_session
2025-07-31 17:51:09|SUCCESS |265884|backend.src.infrastructure.cosmos_db_sessions.create_session:154|üÜï Sesi√≥n creada id=sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_create_session] M√©tricas recogidas: tiempo=1.9458s, cpu=0.00%, memoria_actual=169.62MB, memoria_pico=168.63MB, llamadas=474
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_create_session.json
2025-07-31 17:51:09|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_create_session. Tiempo: 1.946s, Memoria pico: 168.63MB, Llamadas: 474
2025-07-31 17:51:09|SUCCESS |265884|backend.src.routers.chat.process_user_query:77|‚ú® Nueva sesi√≥n creada: sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:09|DEBUG   |265884|backend.src.routers.chat.process_user_query:87|Invocando agente para sesi√≥n: sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: invoke_agent
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: invoke_agent
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_persistent_chat_history
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_persistent_chat_history
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:51:09|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:09.815211-05:00
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0813s, cpu=0.00%, memoria_actual=169.73MB, memoria_pico=169.62MB, llamadas=593
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:51:09|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.081s, Memoria pico: 169.62MB, Llamadas: 593
2025-07-31 17:51:09|DEBUG   |265884|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:126|Historial vac√≠o para session_id=sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[get_persistent_chat_history] M√©tricas recogidas: tiempo=0.0833s, cpu=0.00%, memoria_actual=169.73MB, memoria_pico=169.62MB, llamadas=531
2025-07-31 17:51:09|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_persistent_chat_history.json
2025-07-31 17:51:09|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_persistent_chat_history. Tiempo: 0.083s, Memoria pico: 169.62MB, Llamadas: 531
2025-07-31 17:51:10|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.9501s, cpu=0.00%, memoria_actual=169.77MB, memoria_pico=169.62MB, llamadas=447
2025-07-31 17:51:10|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:51:10|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.950s, Memoria pico: 169.62MB, Llamadas: 447
2025-07-31 17:51:10|DEBUG   |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:182|üìö Historial para grafo (0 mensajes)
2025-07-31 17:51:10|INFO    |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:189|‚ñ∂Ô∏è Invocando grafo con consulta: 'Hola me llamo Jorge‚Ä¶'
2025-07-31 17:51:10|INFO    |265884|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:51:11|SUCCESS |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:195|‚úîÔ∏è Respuesta: '¬°Hola, Jorge! Un gusto saludarte. ¬øEn qu√© puedo ay‚Ä¶'
2025-07-31 17:51:11|INFO    |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:198|üìö Fuentes extra√≠das (controlado por backend): []
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[invoke_agent] M√©tricas recogidas: tiempo=1.9586s, cpu=0.00%, memoria_actual=170.14MB, memoria_pico=169.62MB, llamadas=608
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/invoke_agent.json
2025-07-31 17:51:11|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: invoke_agent. Tiempo: 1.959s, Memoria pico: 169.62MB, Llamadas: 608
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:51:11|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:11.773554-05:00
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0825s, cpu=0.00%, memoria_actual=170.18MB, memoria_pico=170.14MB, llamadas=403
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:51:11|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.082s, Memoria pico: 170.14MB, Llamadas: 403
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0991s, cpu=0.00%, memoria_actual=170.18MB, memoria_pico=170.14MB, llamadas=603
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:51:11|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.099s, Memoria pico: 170.14MB, Llamadas: 603
2025-07-31 17:51:11|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:11.872206-05:00
2025-07-31 17:51:11|SUCCESS |265884|backend.src.routers.chat.process_user_query:113|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[process_user_query] M√©tricas recogidas: tiempo=4.0075s, cpu=0.00%, memoria_actual=170.18MB, memoria_pico=168.61MB, llamadas=1218
2025-07-31 17:51:11|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/process_user_query.json
2025-07-31 17:51:11|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: process_user_query. Tiempo: 4.008s, Memoria pico: 168.61MB, Llamadas: 1218
2025-07-31 17:51:11|INFO    |265884|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4671.22ms)
2025-07-31 17:51:27|INFO    |265884|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-07-31 17:51:27|INFO    |265884|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-07-31 17:51:27|INFO    |265884|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: process_user_query
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: process_user_query
2025-07-31 17:51:27|INFO    |265884|backend.src.routers.chat.process_user_query:56|üì© Recibida nueva consulta al chat.
2025-07-31 17:51:27|DEBUG   |265884|backend.src.routers.chat.process_user_query:57|Payload recibido: session_id='sess_8419441a8b5ec4bf083fb31a69b0049c', query='¬øPuedes darme detalles de tejas de polipropileno?'
2025-07-31 17:51:27|DEBUG   |265884|backend.src.routers.chat.process_user_query:71|Buscando sesi√≥n existente: sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.1009s, cpu=0.00%, memoria_actual=170.18MB, memoria_pico=170.18MB, llamadas=200
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:51:27|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.101s, Memoria pico: 170.18MB, Llamadas: 200
2025-07-31 17:51:27|DEBUG   |265884|backend.src.routers.chat.process_user_query:87|Invocando agente para sesi√≥n: sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: invoke_agent
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: invoke_agent
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: get_persistent_chat_history
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: get_persistent_chat_history
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:51:27|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:27.268501-05:00
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0884s, cpu=0.00%, memoria_actual=170.29MB, memoria_pico=170.18MB, llamadas=593
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:51:27|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.088s, Memoria pico: 170.18MB, Llamadas: 593
2025-07-31 17:51:27|DEBUG   |265884|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:143|üìú Historial convertido (2 mensajes)
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[get_persistent_chat_history] M√©tricas recogidas: tiempo=0.0899s, cpu=0.00%, memoria_actual=170.29MB, memoria_pico=170.18MB, llamadas=531
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/get_persistent_chat_history.json
2025-07-31 17:51:27|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: get_persistent_chat_history. Tiempo: 0.090s, Memoria pico: 170.18MB, Llamadas: 531
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.0925s, cpu=0.00%, memoria_actual=170.29MB, memoria_pico=170.20MB, llamadas=406
2025-07-31 17:51:27|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:51:27|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.092s, Memoria pico: 170.20MB, Llamadas: 406
2025-07-31 17:51:27|DEBUG   |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:182|üìö Historial para grafo (2 mensajes)
2025-07-31 17:51:27|INFO    |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:189|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øPuedes darme detalles de tejas de polipropileno?‚Ä¶'
2025-07-31 17:51:27|INFO    |265884|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:51:28|DEBUG   |265884|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-07-31 17:51:28|DEBUG   |265884|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Tejas de polipropileno'
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: searchai_hybrid_search
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: searchai_hybrid_search
2025-07-31 17:51:28|INFO    |265884|backend.src.infrastructure.searchai.hybrid_search:167|üîéü§ñ B√∫squeda h√≠brida: 'Tejas de polipropileno...' (top_k=10)
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: openai_get_text_embedding
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: openai_get_text_embedding
2025-07-31 17:51:28|DEBUG   |265884|backend.src.infrastructure.openai.get_text_embedding:201|üìä Generando embedding para texto (len=22)
2025-07-31 17:51:28|DEBUG   |265884|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+32.96 en 32.96s)
2025-07-31 17:51:28|DEBUG   |265884|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-07-31 17:51:28|DEBUG   |265884|backend.src.infrastructure.openai.client:105|üîç Accediendo a cliente de OpenAI
2025-07-31 17:51:28|INFO    |265884|backend.src.infrastructure.openai.get_text_embedding:211|‚úÖ Embedding generado (dim=1536)
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[openai_get_text_embedding] M√©tricas recogidas: tiempo=0.4546s, cpu=0.00%, memoria_actual=188.42MB, memoria_pico=170.38MB, llamadas=89799
2025-07-31 17:51:28|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/openai_get_text_embedding.json
2025-07-31 17:51:28|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: openai_get_text_embedding. Tiempo: 0.455s, Memoria pico: 170.38MB, Llamadas: 89799
2025-07-31 17:51:29|SUCCESS |265884|backend.src.infrastructure.searchai.hybrid_search:185|üîç‚úÖ Se devolvieron 10 resultados.
2025-07-31 17:51:29|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[searchai_hybrid_search] M√©tricas recogidas: tiempo=1.1835s, cpu=0.00%, memoria_actual=188.80MB, memoria_pico=170.38MB, llamadas=751
2025-07-31 17:51:29|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/searchai_hybrid_search.json
2025-07-31 17:51:29|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: searchai_hybrid_search. Tiempo: 1.183s, Memoria pico: 170.38MB, Llamadas: 751
2025-07-31 17:51:29|SUCCESS |265884|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-07-31 17:51:29|DEBUG   |265884|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'parent_document_id': '145D9cyoa5HUeTjEItGhdPA-H...
2025-07-31 17:51:29|INFO    |265884|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'teja_adri_polipropileno.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-Ajozinc-Lamina-PVC-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Teja-Greca-Policarbonato-Ajover.pdf'}, {'source_file': 'MANUAL-DE-INSTALACION-TEJAS-PVC.pdf'}, {'source_file': 'Manual-de-Instalacion-Tejas-de-Policarbonato-1.pdf'}]
2025-07-31 17:51:29|INFO    |265884|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-07-31 17:51:34|SUCCESS |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:195|‚úîÔ∏è Respuesta: 'Gracias por tu consulta, Jorge. A continuaci√≥n, te‚Ä¶'
2025-07-31 17:51:34|INFO    |265884|backend.src.orchestrator.settings.agent_factory.invoke_agent:198|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'teja_adri_polipropileno.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-Ajozinc-Lamina-PVC-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Teja-Greca-Policarbonato-Ajover.pdf'}, {'source_file': 'MANUAL-DE-INSTALACION-TEJAS-PVC.pdf'}, {'source_file': 'Manual-de-Instalacion-Tejas-de-Policarbonato-1.pdf'}]
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[invoke_agent] M√©tricas recogidas: tiempo=7.5431s, cpu=0.00%, memoria_actual=188.92MB, memoria_pico=170.18MB, llamadas=608
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/invoke_agent.json
2025-07-31 17:51:34|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: invoke_agent. Tiempo: 7.543s, Memoria pico: 170.18MB, Llamadas: 608
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_get_session
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_get_session
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler.wrapped:325|Llamada a funci√≥n async perfilada: cosmos_sessions_add_message
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler.profile_async:142|Profiling as√≠ncrono iniciado para: cosmos_sessions_add_message
2025-07-31 17:51:34|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:34.811264-05:00
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_get_session] M√©tricas recogidas: tiempo=0.0804s, cpu=0.00%, memoria_actual=188.92MB, memoria_pico=188.92MB, llamadas=603
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_get_session.json
2025-07-31 17:51:34|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_get_session. Tiempo: 0.080s, Memoria pico: 188.92MB, Llamadas: 603
2025-07-31 17:51:34|DEBUG   |265884|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-07-31T17:51:34.891288-05:00
2025-07-31 17:51:34|SUCCESS |265884|backend.src.routers.chat.process_user_query:113|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_8419441a8b5ec4bf083fb31a69b0049c
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[process_user_query] M√©tricas recogidas: tiempo=7.7286s, cpu=0.00%, memoria_actual=188.92MB, memoria_pico=170.18MB, llamadas=1201
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/process_user_query.json
2025-07-31 17:51:34|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: process_user_query. Tiempo: 7.729s, Memoria pico: 170.18MB, Llamadas: 1201
2025-07-31 17:51:34|INFO    |265884|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 7730.43ms)
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._collect_metrics:211|[cosmos_sessions_add_message] M√©tricas recogidas: tiempo=0.1131s, cpu=0.00%, memoria_actual=188.92MB, memoria_pico=188.92MB, llamadas=416
2025-07-31 17:51:34|DEBUG   |265884|backend.src.core.profiler._write_json:237|Archivo de m√©tricas guardado: performance/cosmos_sessions_add_message.json
2025-07-31 17:51:34|INFO    |265884|backend.src.core.profiler.profile_async:170|Profiling as√≠ncrono finalizado para: cosmos_sessions_add_message. Tiempo: 0.113s, Memoria pico: 188.92MB, Llamadas: 416
2025-08-16 19:04:41|INFO    |62325|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-08-16 19:04:41|DEBUG   |62325|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-08-16 19:04:41|INFO    |62325|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:04:41|INFO    |62325|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-08-16 19:04:41|INFO    |62325|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-08-16 19:04:41|INFO    |62325|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:74|Registrando middleware CORS.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:82|Middleware CORS registrado.
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:87|Incluyendo routers.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-08-16 19:04:41|INFO    |62325|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-08-16 19:04:41|INFO    |62325|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:04:41|INFO    |62325|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-08-16 19:04:41|INFO    |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:46|üîß Creando instancia del agente...
2025-08-16 19:04:41|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:55|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index)
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.openai.create:71|üîß Iniciando OpenAI.create()
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.openai._ensure_settings:60|üîç Validando configuraci√≥n de OpenAI
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.openai.create:77|üîë Configuraci√≥n de API key y endpoint encontrada
2025-08-16 19:04:41|SUCCESS |62325|backend.src.infrastructure.openai.create:86|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.openai.__init__:45|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-08-16 19:04:41|INFO    |62325|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.openai.__init__:54|‚úÖ Servicio OpenAI inicializado correctamente
2025-08-16 19:04:41|SUCCESS |62325|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-08-16 19:04:41|DEBUG   |62325|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:60|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index')
2025-08-16 19:04:41|INFO    |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:64|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-08-16 19:04:41|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:73|‚úÖ Modelo AzureChatOpenAI listo.
2025-08-16 19:04:41|INFO    |62325|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-08-16 19:04:41|SUCCESS |62325|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-08-16 19:04:41|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:83|üöÄ Agente listo para solicitudes.
2025-08-16 19:04:41|INFO    |62325|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-08-16 19:04:41|INFO    |62325|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-08-16 19:04:48|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:04:48|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-08-16 19:04:48|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-08-16 19:04:48|INFO    |62325|backend.src.routers.meta.get_scalar_docs:88|‚Üí Llamada a get_scalar_docs
2025-08-16 19:04:48|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.45ms)
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:04:49|DEBUG   |62325|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-08-16 19:04:49|INFO    |62325|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.68ms)
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:04:49|DEBUG   |62325|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.61ms)
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:04:49|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/favicon.ico
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /favicon.ico
2025-08-16 19:04:49|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 404 (tard√≥ 0.28ms)
2025-08-16 19:05:04|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:05:04|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:05:04|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:05:04|WARNING |62325|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-08-16 19:05:04|INFO    |62325|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-08-16 19:05:04|INFO    |62325|backend.src.orchestrator.settings.agent_factory.initialize_agent:43|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-08-16 19:05:04|INFO    |62325|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-08-16 19:05:05|SUCCESS |62325|backend.src.infrastructure.cosmos_db_sessions.create:104|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-08-16 19:05:05|SUCCESS |62325|backend.src.infrastructure.cosmos_db_users.create:97|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-08-16 19:05:05|DEBUG   |62325|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-08-16 19:05:05|INFO    |62325|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-08-16 19:05:05|SUCCESS |62325|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-08-16 19:05:05|DEBUG   |62325|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-08-16 19:05:05|SUCCESS |62325|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-08-16 19:05:05|SUCCESS |62325|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-08-16 19:05:05|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:05:05|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:05:05|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='Hola me llamo Jorge'
2025-08-16 19:05:05|INFO    |62325|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-16 19:05:07|SUCCESS |62325|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:07|SUCCESS |62325|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:07|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:07|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:07.254741-05:00
2025-08-16 19:05:07|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:08|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-16 19:05:08|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Hola me llamo Jorge‚Ä¶'
2025-08-16 19:05:08|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:05:09|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '¬°Hola, Jorge! üòä ¬øEn qu√© puedo ayudarte hoy?‚Ä¶'
2025-08-16 19:05:09|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:05:09|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:09.020581-05:00
2025-08-16 19:05:09|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:09.100782-05:00
2025-08-16 19:05:09|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:09|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4104.58ms)
2025-08-16 19:05:48|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:05:48|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:05:48|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:05:48|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:05:48|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:05:48|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:05:48|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_e24d9aa7148f2a6111425f3f32f286f2', query='¬øCu√°les son todas las tejas de policarbonato que manejan?'
2025-08-16 19:05:48|DEBUG   |62325|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:48|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:48|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:48.597819-05:00
2025-08-16 19:05:48|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (2 mensajes)
2025-08-16 19:05:48|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (2 mensajes)
2025-08-16 19:05:48|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øCu√°les son todas las tejas de policarbonato que m‚Ä¶'
2025-08-16 19:05:48|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:05:50|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Se encontraron 7 referencias en **Tejas de Policar‚Ä¶'
2025-08-16 19:05:50|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:05:50|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:50.269875-05:00
2025-08-16 19:05:50|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:05:50.360989-05:00
2025-08-16 19:05:50|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:05:50|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1840.90ms)
2025-08-16 19:06:28|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:06:28|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:06:28|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:06:28|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:06:28|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:06:28|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:06:28|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_e24d9aa7148f2a6111425f3f32f286f2', query='¬øVenden v√°lvulas de bola de 1/2?'
2025-08-16 19:06:28|DEBUG   |62325|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:06:28|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:06:28|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:06:28.274482-05:00
2025-08-16 19:06:28|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (4 mensajes)
2025-08-16 19:06:28|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (4 mensajes)
2025-08-16 19:06:28|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øVenden v√°lvulas de bola de 1/2?‚Ä¶'
2025-08-16 19:06:28|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:06:30|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Gracias por tu consulta. Actualmente **no comercia‚Ä¶'
2025-08-16 19:06:30|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:06:30|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:06:30.148973-05:00
2025-08-16 19:06:30|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:06:30.228517-05:00
2025-08-16 19:06:30|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:06:30|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2032.64ms)
2025-08-16 19:07:16|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:07:16|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:07:16|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:07:16|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:07:16|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:07:16|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:07:16|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_e24d9aa7148f2a6111425f3f32f286f2', query='Necesito la ficha t√©cnica completa de la Ajota Trapezoidal A360 Policarbonato.'
2025-08-16 19:07:16|DEBUG   |62325|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:16|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:16|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:16.942194-05:00
2025-08-16 19:07:17|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (6 mensajes)
2025-08-16 19:07:17|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (6 mensajes)
2025-08-16 19:07:17|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Necesito la ficha t√©cnica completa de la Ajota Tra‚Ä¶'
2025-08-16 19:07:17|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:07:17|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:07:17|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Ajota Trapezoidal A360 Policarbonato'
2025-08-16 19:07:17|INFO    |62325|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Ajota Trapezoidal A360 Policarbonato...' (top_k=10)
2025-08-16 19:07:17|DEBUG   |62325|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=36)
2025-08-16 19:07:17|DEBUG   |62325|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+156.32 en 156.32s)
2025-08-16 19:07:17|DEBUG   |62325|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:07:17|DEBUG   |62325|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:07:20|INFO    |62325|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:07:21|SUCCESS |62325|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:07:21|SUCCESS |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:07:21|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'parent_document_id': 'RxMlQEQGRhhlQpQFXtIcNWj_L...
2025-08-16 19:07:21|INFO    |62325|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:07:21|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:07:23|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Ajota Trapezoidal A360 Policarbonato‚Ä¶'
2025-08-16 19:07:23|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:07:23|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:23.017124-05:00
2025-08-16 19:07:23|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:23.097317-05:00
2025-08-16 19:07:23|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:23|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 6233.68ms)
2025-08-16 19:07:45|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:07:45|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:07:45|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:07:45|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:07:45|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:07:45|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:07:45|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_e24d9aa7148f2a6111425f3f32f286f2', query='¬øQu√© tejas manejan?'
2025-08-16 19:07:45|DEBUG   |62325|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:46|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:46|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:46.057497-05:00
2025-08-16 19:07:46|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (8 mensajes)
2025-08-16 19:07:46|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (8 mensajes)
2025-08-16 19:07:46|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øQu√© tejas manejan?‚Ä¶'
2025-08-16 19:07:46|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:07:48|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Se encontraron 3 categor√≠as de tejas en el portafo‚Ä¶'
2025-08-16 19:07:48|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:07:48|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:48.667525-05:00
2025-08-16 19:07:48|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:07:48.746639-05:00
2025-08-16 19:07:48|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:07:48|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2767.83ms)
2025-08-16 19:08:09|INFO    |62325|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:08:09|INFO    |62325|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:08:09|INFO    |62325|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:08:09|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:08:09|DEBUG   |62325|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:08:09|INFO    |62325|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:08:09|DEBUG   |62325|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_e24d9aa7148f2a6111425f3f32f286f2', query='Dame la ficha t√©cnica del Sistema S√©ptico EcoAjover (TS/TI/TG/TA/TAE): dimensiones, capacidades y accesorios incluidos.'
2025-08-16 19:08:09|DEBUG   |62325|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:08:09|DEBUG   |62325|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:08:09|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:08:09.576717-05:00
2025-08-16 19:08:09|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (10 mensajes)
2025-08-16 19:08:09|DEBUG   |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (10 mensajes)
2025-08-16 19:08:09|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Dame la ficha t√©cnica del Sistema S√©ptico EcoAjove‚Ä¶'
2025-08-16 19:08:09|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:08:10|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:08:10|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE dimensiones capacidades accesorios incluidos'
2025-08-16 19:08:10|INFO    |62325|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE dimensio...' (top_k=10)
2025-08-16 19:08:10|DEBUG   |62325|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=86)
2025-08-16 19:08:10|DEBUG   |62325|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+52.76 en 52.76s)
2025-08-16 19:08:10|DEBUG   |62325|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:08:10|DEBUG   |62325|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:08:11|INFO    |62325|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:08:11|SUCCESS |62325|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:08:11|SUCCESS |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:08:11|DEBUG   |62325|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'parent_document_id': 'v5QZIk_Ol9RP9SBlyt0ttyCJI...
2025-08-16 19:08:11|INFO    |62325|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Contenedor-Rectangular-Multiusos-con-Tapa-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Horizontales-para-Transporte-y-o-Uso-Subterraneo-Ajover-03-2021.pdf'}]
2025-08-16 19:08:11|INFO    |62325|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:08:15|SUCCESS |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Sistema S√©ptico EcoAjover (TS/TI/TG/‚Ä¶'
2025-08-16 19:08:15|INFO    |62325|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Contenedor-Rectangular-Multiusos-con-Tapa-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Horizontales-para-Transporte-y-o-Uso-Subterraneo-Ajover-03-2021.pdf'}]
2025-08-16 19:08:15|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:08:15.221032-05:00
2025-08-16 19:08:15|DEBUG   |62325|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:08:15.299925-05:00
2025-08-16 19:08:15|SUCCESS |62325|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_e24d9aa7148f2a6111425f3f32f286f2
2025-08-16 19:08:15|INFO    |62325|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5801.94ms)
2025-08-16 19:26:08|INFO    |70168|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-08-16 19:26:08|DEBUG   |70168|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-08-16 19:26:08|INFO    |70168|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:26:08|INFO    |70168|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-08-16 19:26:08|INFO    |70168|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-08-16 19:26:08|INFO    |70168|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:74|Registrando middleware CORS.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:82|Middleware CORS registrado.
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:87|Incluyendo routers.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-08-16 19:26:08|INFO    |70168|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-08-16 19:26:08|INFO    |70168|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:26:08|INFO    |70168|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-08-16 19:26:08|INFO    |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:46|üîß Creando instancia del agente...
2025-08-16 19:26:08|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:55|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index)
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.openai.create:71|üîß Iniciando OpenAI.create()
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.openai._ensure_settings:60|üîç Validando configuraci√≥n de OpenAI
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.openai.create:77|üîë Configuraci√≥n de API key y endpoint encontrada
2025-08-16 19:26:08|SUCCESS |70168|backend.src.infrastructure.openai.create:86|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.openai.__init__:45|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-08-16 19:26:08|INFO    |70168|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.openai.__init__:54|‚úÖ Servicio OpenAI inicializado correctamente
2025-08-16 19:26:08|SUCCESS |70168|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-08-16 19:26:08|DEBUG   |70168|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:60|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index')
2025-08-16 19:26:08|INFO    |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:64|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-08-16 19:26:08|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:73|‚úÖ Modelo AzureChatOpenAI listo.
2025-08-16 19:26:08|INFO    |70168|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-08-16 19:26:08|SUCCESS |70168|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-08-16 19:26:08|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:83|üöÄ Agente listo para solicitudes.
2025-08-16 19:26:08|INFO    |70168|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-08-16 19:26:08|INFO    |70168|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-08-16 19:26:10|INFO    |70168|backend.src.routers.meta.get_scalar_docs:88|‚Üí Llamada a get_scalar_docs
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.47ms)
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:26:10|DEBUG   |70168|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-08-16 19:26:10|INFO    |70168|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 6.85ms)
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:26:10|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:26:10|DEBUG   |70168|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-08-16 19:26:10|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.36ms)
2025-08-16 19:26:19|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:26:19|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:26:19|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:26:19|WARNING |70168|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-08-16 19:26:19|INFO    |70168|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-08-16 19:26:19|INFO    |70168|backend.src.orchestrator.settings.agent_factory.initialize_agent:43|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-08-16 19:26:19|INFO    |70168|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-08-16 19:26:19|SUCCESS |70168|backend.src.infrastructure.cosmos_db_sessions.create:104|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-08-16 19:26:19|SUCCESS |70168|backend.src.infrastructure.cosmos_db_users.create:97|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-08-16 19:26:19|DEBUG   |70168|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-08-16 19:26:20|INFO    |70168|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-08-16 19:26:20|SUCCESS |70168|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-08-16 19:26:20|DEBUG   |70168|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-08-16 19:26:20|SUCCESS |70168|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-08-16 19:26:20|SUCCESS |70168|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-08-16 19:26:20|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:26:20|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:26:20|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='Hola me llamo Jorge'
2025-08-16 19:26:20|INFO    |70168|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-16 19:26:22|SUCCESS |70168|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:26:22|SUCCESS |70168|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:26:22|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:26:22|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:26:22.218580-05:00
2025-08-16 19:26:22|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:26:23|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-16 19:26:23|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Hola me llamo Jorge‚Ä¶'
2025-08-16 19:26:23|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:26:24|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Hola Jorge, un gusto saludarte. ¬øEn qu√© puedo ayud‚Ä¶'
2025-08-16 19:26:24|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:26:24|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:26:24.199668-05:00
2025-08-16 19:26:24|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:26:24.280603-05:00
2025-08-16 19:26:24|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:26:24|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4560.06ms)
2025-08-16 19:27:39|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:27:39|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:27:39|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:27:39|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:27:39|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:27:39|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:27:39|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_360f333b3c3f8af020ae1f0763c4812c', query='¬øCu√°les son todas las tejas de policarbonato que manejan?'
2025-08-16 19:27:39|DEBUG   |70168|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:27:39|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:27:39|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:27:39.437024-05:00
2025-08-16 19:27:39|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (2 mensajes)
2025-08-16 19:27:39|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (2 mensajes)
2025-08-16 19:27:39|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øCu√°les son todas las tejas de policarbonato que m‚Ä¶'
2025-08-16 19:27:39|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:27:41|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Se encontraron 7 referencias en **Tejas de Policar‚Ä¶'
2025-08-16 19:27:41|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:27:41|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:27:41.422774-05:00
2025-08-16 19:27:41|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:27:41.513859-05:00
2025-08-16 19:27:41|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:27:41|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2158.02ms)
2025-08-16 19:28:00|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:28:00|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:28:00|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:28:00|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 422 (tard√≥ 0.44ms)
2025-08-16 19:28:08|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:28:08|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:28:08|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:28:08|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:08|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:08|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:28:08|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_360f333b3c3f8af020ae1f0763c4812c', query='¬øVenden v√°lvulas de bola de 1/2?'
2025-08-16 19:28:08|DEBUG   |70168|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:08|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:08|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:08.785807-05:00
2025-08-16 19:28:08|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (4 mensajes)
2025-08-16 19:28:08|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (4 mensajes)
2025-08-16 19:28:08|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øVenden v√°lvulas de bola de 1/2?‚Ä¶'
2025-08-16 19:28:08|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:28:10|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Gracias por tu consulta. Actualmente **no comercia‚Ä¶'
2025-08-16 19:28:10|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:28:10|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:10.624410-05:00
2025-08-16 19:28:10|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:10.704364-05:00
2025-08-16 19:28:10|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:10|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2000.97ms)
2025-08-16 19:28:27|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:28:27|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:28:27|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:28:27|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:27|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:27|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:28:27|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_360f333b3c3f8af020ae1f0763c4812c', query='Necesito la ficha t√©cnica completa de la Ajota Trapezoidal A360 Policarbonato.'
2025-08-16 19:28:27|DEBUG   |70168|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:27|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:27|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:27.775075-05:00
2025-08-16 19:28:27|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (6 mensajes)
2025-08-16 19:28:27|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (6 mensajes)
2025-08-16 19:28:27|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Necesito la ficha t√©cnica completa de la Ajota Tra‚Ä¶'
2025-08-16 19:28:27|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:28:28|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:28:28|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Ajota Trapezoidal A360 Policarbonato'
2025-08-16 19:28:28|INFO    |70168|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Ajota Trapezoidal A360 Policarbonato...' (top_k=10)
2025-08-16 19:28:28|DEBUG   |70168|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=36)
2025-08-16 19:28:28|DEBUG   |70168|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+140.62 en 140.62s)
2025-08-16 19:28:28|DEBUG   |70168|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:28:28|DEBUG   |70168|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:28:29|INFO    |70168|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:28:30|SUCCESS |70168|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:28:30|SUCCESS |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:28:30|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'id': 'GT1Ywr_fB8NrhjKO_OfavSAOdq8-nZfhe74Gh-Lf'...
2025-08-16 19:28:30|INFO    |70168|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:28:30|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:28:34|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Ajota Trapezoidal A360 Policarbonato‚Ä¶'
2025-08-16 19:28:34|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:28:34|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:34.456527-05:00
2025-08-16 19:28:34|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:34.536952-05:00
2025-08-16 19:28:34|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:34|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 6843.51ms)
2025-08-16 19:28:51|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:28:51|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:28:51|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:28:51|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:51|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:28:51|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:28:51|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_360f333b3c3f8af020ae1f0763c4812c', query='¬øQu√© tejas manejan?'
2025-08-16 19:28:51|DEBUG   |70168|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:51|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:51|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:51.957103-05:00
2025-08-16 19:28:52|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (8 mensajes)
2025-08-16 19:28:52|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (8 mensajes)
2025-08-16 19:28:52|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øQu√© tejas manejan?‚Ä¶'
2025-08-16 19:28:52|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:28:53|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Puedo ayudarte con precisi√≥n. ¬øA cu√°l de estas cat‚Ä¶'
2025-08-16 19:28:53|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:28:53|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:53.485804-05:00
2025-08-16 19:28:53|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:28:53.566751-05:00
2025-08-16 19:28:53|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:28:53|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1691.30ms)
2025-08-16 19:29:07|INFO    |70168|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:29:07|INFO    |70168|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:29:07|INFO    |70168|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:29:07|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:29:07|DEBUG   |70168|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:29:07|INFO    |70168|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:29:07|DEBUG   |70168|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_360f333b3c3f8af020ae1f0763c4812c', query='Dame la ficha t√©cnica del Sistema S√©ptico EcoAjover (TS/TI/TG/TA/TAE): dimensiones, capacidades y accesorios incluidos.'
2025-08-16 19:29:07|DEBUG   |70168|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:29:07|DEBUG   |70168|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:29:07|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:29:07.243148-05:00
2025-08-16 19:29:07|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (10 mensajes)
2025-08-16 19:29:07|DEBUG   |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (10 mensajes)
2025-08-16 19:29:07|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Dame la ficha t√©cnica del Sistema S√©ptico EcoAjove‚Ä¶'
2025-08-16 19:29:07|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:29:08|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:29:08|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE dimensiones capacidades accesorios'
2025-08-16 19:29:08|INFO    |70168|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE dimensio...' (top_k=10)
2025-08-16 19:29:08|DEBUG   |70168|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=76)
2025-08-16 19:29:08|DEBUG   |70168|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+39.77 en 39.77s)
2025-08-16 19:29:08|DEBUG   |70168|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:29:08|DEBUG   |70168|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:29:08|INFO    |70168|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:29:09|SUCCESS |70168|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:29:09|SUCCESS |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:29:09|DEBUG   |70168|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'id': '8jERiwZw9iSw_B92_fmZ0scVnQ62GUecqfgzxiPw'...
2025-08-16 19:29:09|INFO    |70168|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'FT-Contenedor-Rectangular-Multiusos-con-Tapa-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Horizontales-para-Transporte-y-o-Uso-Subterraneo-Ajover-03-2021.pdf'}]
2025-08-16 19:29:09|INFO    |70168|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:29:14|SUCCESS |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Sistema S√©ptico EcoAjover (TS/TI/TG/‚Ä¶'
2025-08-16 19:29:14|INFO    |70168|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'FT-Contenedor-Rectangular-Multiusos-con-Tapa-Ajover.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Horizontales-para-Transporte-y-o-Uso-Subterraneo-Ajover-03-2021.pdf'}]
2025-08-16 19:29:14|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:29:14.243836-05:00
2025-08-16 19:29:14|DEBUG   |70168|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:29:14.325302-05:00
2025-08-16 19:29:14|SUCCESS |70168|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_360f333b3c3f8af020ae1f0763c4812c
2025-08-16 19:29:14|INFO    |70168|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 7163.67ms)
2025-08-16 19:34:28|INFO    |73429|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-08-16 19:34:28|DEBUG   |73429|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-08-16 19:34:28|INFO    |73429|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:34:28|INFO    |73429|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-08-16 19:34:28|INFO    |73429|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-08-16 19:34:28|INFO    |73429|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:74|Registrando middleware CORS.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:82|Middleware CORS registrado.
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:87|Incluyendo routers.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-08-16 19:34:28|INFO    |73429|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-08-16 19:34:28|INFO    |73429|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-16 19:34:28|INFO    |73429|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-08-16 19:34:28|INFO    |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:46|üîß Creando instancia del agente...
2025-08-16 19:34:28|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:55|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index)
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.openai.create:71|üîß Iniciando OpenAI.create()
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.openai._ensure_settings:60|üîç Validando configuraci√≥n de OpenAI
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.openai.create:77|üîë Configuraci√≥n de API key y endpoint encontrada
2025-08-16 19:34:28|SUCCESS |73429|backend.src.infrastructure.openai.create:86|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.openai.__init__:45|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-08-16 19:34:28|INFO    |73429|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.openai.__init__:54|‚úÖ Servicio OpenAI inicializado correctamente
2025-08-16 19:34:28|SUCCESS |73429|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-08-16 19:34:28|DEBUG   |73429|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:60|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index')
2025-08-16 19:34:28|INFO    |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:64|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-08-16 19:34:28|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:73|‚úÖ Modelo AzureChatOpenAI listo.
2025-08-16 19:34:28|INFO    |73429|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-08-16 19:34:28|SUCCESS |73429|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-08-16 19:34:28|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:83|üöÄ Agente listo para solicitudes.
2025-08-16 19:34:28|INFO    |73429|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-08-16 19:34:28|INFO    |73429|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-08-16 19:35:02|INFO    |73429|backend.src.routers.meta.get_scalar_docs:88|‚Üí Llamada a get_scalar_docs
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.44ms)
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:35:02|DEBUG   |73429|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-08-16 19:35:02|INFO    |73429|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.70ms)
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:35:02|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-16 19:35:02|DEBUG   |73429|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-08-16 19:35:02|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.47ms)
2025-08-16 19:35:06|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:35:06|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:35:06|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:35:06|WARNING |73429|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-08-16 19:35:06|INFO    |73429|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-08-16 19:35:06|INFO    |73429|backend.src.orchestrator.settings.agent_factory.initialize_agent:43|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-08-16 19:35:06|INFO    |73429|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-08-16 19:35:06|SUCCESS |73429|backend.src.infrastructure.cosmos_db_sessions.create:104|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-08-16 19:35:06|SUCCESS |73429|backend.src.infrastructure.cosmos_db_users.create:97|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-08-16 19:35:06|DEBUG   |73429|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-08-16 19:35:07|INFO    |73429|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-08-16 19:35:07|SUCCESS |73429|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-08-16 19:35:07|DEBUG   |73429|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-08-16 19:35:07|SUCCESS |73429|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-08-16 19:35:07|SUCCESS |73429|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-08-16 19:35:07|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:35:07|INFO    |73429|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:35:07|DEBUG   |73429|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='Necesito la ficha t√©cnica completa de la Ajota Trapezoidal A360 Policarbonato.'
2025-08-16 19:35:07|INFO    |73429|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-16 19:35:08|SUCCESS |73429|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:08|SUCCESS |73429|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:08|DEBUG   |73429|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:08|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:08.957136-05:00
2025-08-16 19:35:09|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:09|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-16 19:35:09|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Necesito la ficha t√©cnica completa de la Ajota Tra‚Ä¶'
2025-08-16 19:35:09|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:35:10|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:35:10|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Ajota Trapezoidal A360 Policarbonato ficha t√©cnica'
2025-08-16 19:35:10|INFO    |73429|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Ajota Trapezoidal A360 Policarbonato ficha t√©cnica...' (top_k=10)
2025-08-16 19:35:10|DEBUG   |73429|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=50)
2025-08-16 19:35:10|DEBUG   |73429|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+42.55 en 42.55s)
2025-08-16 19:35:10|DEBUG   |73429|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:35:10|DEBUG   |73429|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:35:11|INFO    |73429|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:35:12|SUCCESS |73429|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:35:12|SUCCESS |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:35:12|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'source_file': 'FT-Cubierta-Ajover-Premium-Trape...
2025-08-16 19:35:12|INFO    |73429|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Arquitectonica-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:35:12|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:35:17|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Ajota Trapezoidal A360 Policarbonato‚Ä¶'
2025-08-16 19:35:17|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Cubierta-Ajover-Premium-Trapezoidal-A360_low_compressed-comprimido.pdf'}, {'source_file': 'FT-Teja-Ajota-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Cubierta-Ajover-Silver-Trapezoidal-A360.pdf'}, {'source_file': 'FT-Teja-Ajota-Trapezoidal-PVC-Ajover.pdf'}, {'source_file': 'FT-Teja-Ondulada-Policarbonato-Ajover-1.pdf'}, {'source_file': 'FT-Teja-Arquitectonica-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}, {'source_file': 'FT-Teja-M1000-Policarbonato-Ajover-2.pdf'}]
2025-08-16 19:35:17|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:17.401449-05:00
2025-08-16 19:35:17|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:17.481142-05:00
2025-08-16 19:35:17|SUCCESS |73429|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:17|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 10909.41ms)
2025-08-16 19:35:44|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:35:44|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:35:44|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:35:44|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:35:44|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:35:44|INFO    |73429|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:35:44|DEBUG   |73429|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_3237349049cbbaee431e38da7fe68995', query='Dame la ficha t√©cnica del Sistema S√©ptico EcoAjover (TS/TI/TG/TA/TAE): dimensiones, capacidades y accesorios incluidos.'
2025-08-16 19:35:44|DEBUG   |73429|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:44|DEBUG   |73429|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:44|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:44.083228-05:00
2025-08-16 19:35:44|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (2 mensajes)
2025-08-16 19:35:44|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (2 mensajes)
2025-08-16 19:35:44|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'Dame la ficha t√©cnica del Sistema S√©ptico EcoAjove‚Ä¶'
2025-08-16 19:35:44|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:35:45|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:65|üü† [tool_pdf_search] Invocada (b√∫squeda PDF).
2025-08-16 19:35:45|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:71|üüß Ejecutando hybrid_search en √≠ndice PDF: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE ficha t√©cnica dimensiones capacidades accesorios incluidos'
2025-08-16 19:35:45|INFO    |73429|backend.src.infrastructure.searchai.hybrid_search:163|üîéü§ñ B√∫squeda h√≠brida: 'Sistema S√©ptico EcoAjover TS TI TG TA TAE ficha t√©...' (top_k=10)
2025-08-16 19:35:45|DEBUG   |73429|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=100)
2025-08-16 19:35:45|DEBUG   |73429|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+34.23 en 34.23s)
2025-08-16 19:35:45|DEBUG   |73429|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-16 19:35:45|DEBUG   |73429|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-16 19:35:45|INFO    |73429|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-16 19:35:46|SUCCESS |73429|backend.src.infrastructure.searchai.hybrid_search:181|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-16 19:35:46|SUCCESS |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:76|üüß PDFs encontrados: 10
2025-08-16 19:35:46|DEBUG   |73429|backend.src.orchestrator.tools.pdf_content.tool_pdf_search:77|üü† [tool_pdf_search] Respuesta raw de SearchAI: [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'...
2025-08-16 19:35:46|INFO    |73429|backend.src.orchestrator.settings.agent_settings._tools_node:147|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}]
2025-08-16 19:35:46|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:35:50|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: '**Producto:** Sistema S√©ptico EcoAjover (TS/TI/TG/‚Ä¶'
2025-08-16 19:35:50|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_file': 'FT-Tanques-Multiusos-Ajover.pdf'}, {'source_file': 'Portafolio-de-prodcutos-ajover.pdf'}, {'source_file': 'FT-Tanque-Tipo-Botella-Ajover_2024.pdf'}, {'source_file': 'FT-Tanques-Conicos-de-Almacenamiento-Multiproposito-con-Tapa-Ajover_2024.pdf'}, {'source_file': 'FT-Teja-Ajonit-Policarbonato-Ajover.pdf'}]
2025-08-16 19:35:50|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:50.327427-05:00
2025-08-16 19:35:50|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:35:50.407228-05:00
2025-08-16 19:35:50|SUCCESS |73429|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:35:50|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 6404.63ms)
2025-08-16 19:38:19|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:38:19|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:38:19|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:38:19|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:38:19|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:38:19|INFO    |73429|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:38:19|DEBUG   |73429|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_3237349049cbbaee431e38da7fe68995', query='¬øCu√°l es el peso por metro cuadrado de la l√°mina de policarbonato alveolar?'
2025-08-16 19:38:19|DEBUG   |73429|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:38:20|DEBUG   |73429|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:38:20|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:38:20.072445-05:00
2025-08-16 19:38:20|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (4 mensajes)
2025-08-16 19:38:20|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (4 mensajes)
2025-08-16 19:38:20|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øCu√°l es el peso por metro cuadrado de la l√°mina d‚Ä¶'
2025-08-16 19:38:20|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:38:22|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'El peso por metro cuadrado de la l√°mina de policar‚Ä¶'
2025-08-16 19:38:22|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:38:22|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:38:22.052057-05:00
2025-08-16 19:38:22|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:38:22.132722-05:00
2025-08-16 19:38:22|SUCCESS |73429|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:38:22|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 3120.02ms)
2025-08-16 19:39:31|INFO    |73429|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-16 19:39:31|INFO    |73429|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-16 19:39:31|INFO    |73429|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-16 19:39:31|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:39:31|DEBUG   |73429|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-16 19:39:31|INFO    |73429|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-16 19:39:31|DEBUG   |73429|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_3237349049cbbaee431e38da7fe68995', query='¬øCu√°ntos a√±os de garant√≠a tiene la teja alveolar?'
2025-08-16 19:39:31|DEBUG   |73429|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:39:31|DEBUG   |73429|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:39:31|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:39:31.992089-05:00
2025-08-16 19:39:32|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (6 mensajes)
2025-08-16 19:39:32|DEBUG   |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (6 mensajes)
2025-08-16 19:39:32|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: '¬øCu√°ntos a√±os de garant√≠a tiene la teja alveolar?‚Ä¶'
2025-08-16 19:39:32|INFO    |73429|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-16 19:39:33|SUCCESS |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'La garant√≠a de la l√°mina de policarbonato alveolar‚Ä¶'
2025-08-16 19:39:33|INFO    |73429|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-16 19:39:33|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:39:33.212667-05:00
2025-08-16 19:39:33|DEBUG   |73429|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-16T19:39:33.305696-05:00
2025-08-16 19:39:33|SUCCESS |73429|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3237349049cbbaee431e38da7fe68995
2025-08-16 19:39:33|INFO    |73429|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1406.93ms)
2025-08-17 14:49:42|INFO    |140291|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-08-17 14:49:42|DEBUG   |140291|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-08-17 14:49:42|INFO    |140291|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 14:49:42|INFO    |140291|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-08-17 14:49:42|INFO    |140291|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-08-17 14:49:42|INFO    |140291|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:74|Registrando middleware CORS.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:82|Middleware CORS registrado.
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:87|Incluyendo routers.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-08-17 14:49:42|INFO    |140291|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-08-17 14:49:42|INFO    |140291|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 14:49:42|INFO    |140291|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-08-17 14:49:42|INFO    |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:46|üîß Creando instancia del agente...
2025-08-17 14:49:42|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:55|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index-v2)
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.openai.create:71|üîß Iniciando OpenAI.create()
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.openai._ensure_settings:60|üîç Validando configuraci√≥n de OpenAI
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.openai.create:77|üîë Configuraci√≥n de API key y endpoint encontrada
2025-08-17 14:49:42|SUCCESS |140291|backend.src.infrastructure.openai.create:86|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.openai.__init__:45|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-08-17 14:49:42|INFO    |140291|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.openai.__init__:54|‚úÖ Servicio OpenAI inicializado correctamente
2025-08-17 14:49:42|SUCCESS |140291|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.infrastructure.infrastructure.create_searchai:123|üîó‚úÖ SearchAI inicializado para √≠ndice 'pdf-index-v2' (pdf).
2025-08-17 14:49:42|SUCCESS |140291|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'web-index-v2'.
2025-08-17 14:49:42|DEBUG   |140291|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'web-index-v2' asignados.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.infrastructure.infrastructure.create_searchai:123|üîó‚úÖ SearchAI inicializado para √≠ndice 'web-index-v2' (web).
2025-08-17 14:49:42|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:60|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index-v2')
2025-08-17 14:49:42|INFO    |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:64|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-08-17 14:49:42|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:73|‚úÖ Modelo AzureChatOpenAI listo.
2025-08-17 14:49:42|INFO    |140291|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-08-17 14:49:42|SUCCESS |140291|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-08-17 14:49:42|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:83|üöÄ Agente listo para solicitudes.
2025-08-17 14:49:42|INFO    |140291|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-08-17 14:49:42|INFO    |140291|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-08-17 14:49:48|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:49:48|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/favicon.ico
2025-08-17 14:49:48|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /favicon.ico
2025-08-17 14:49:48|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 404 (tard√≥ 0.33ms)
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-08-17 14:49:52|INFO    |140291|backend.src.routers.meta.get_scalar_docs:88|‚Üí Llamada a get_scalar_docs
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.52ms)
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-17 14:49:52|DEBUG   |140291|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-08-17 14:49:52|INFO    |140291|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.84ms)
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:49:52|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-17 14:49:52|DEBUG   |140291|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-08-17 14:49:52|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.40ms)
2025-08-17 14:50:01|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:50:01|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 14:50:01|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 14:50:01|WARNING |140291|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-08-17 14:50:01|INFO    |140291|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-08-17 14:50:01|INFO    |140291|backend.src.orchestrator.settings.agent_factory.initialize_agent:43|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-08-17 14:50:01|INFO    |140291|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-08-17 14:50:01|SUCCESS |140291|backend.src.infrastructure.cosmos_db_sessions.create:104|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-08-17 14:50:01|SUCCESS |140291|backend.src.infrastructure.cosmos_db_users.create:97|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-08-17 14:50:01|DEBUG   |140291|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-08-17 14:50:02|INFO    |140291|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-08-17 14:50:02|SUCCESS |140291|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-08-17 14:50:02|DEBUG   |140291|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-08-17 14:50:02|SUCCESS |140291|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-08-17 14:50:02|SUCCESS |140291|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-08-17 14:50:02|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:50:02|INFO    |140291|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 14:50:02|DEBUG   |140291|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='quien es ajover?'
2025-08-17 14:50:02|INFO    |140291|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 14:50:04|SUCCESS |140291|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_dcadb90e2a06faa7beb96b8acbe484e0
2025-08-17 14:50:04|SUCCESS |140291|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_dcadb90e2a06faa7beb96b8acbe484e0
2025-08-17 14:50:04|DEBUG   |140291|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_dcadb90e2a06faa7beb96b8acbe484e0
2025-08-17 14:50:04|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:50:04.290241-05:00
2025-08-17 14:50:04|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_dcadb90e2a06faa7beb96b8acbe484e0
2025-08-17 14:50:05|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 14:50:05|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'quien es ajover?‚Ä¶'
2025-08-17 14:50:05|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:50:06|DEBUG   |140291|backend.src.orchestrator.tools.web_content.tool_web_search:115|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 14:50:06|DEBUG   |140291|backend.src.orchestrator.tools.web_content._expand_query_if_needed:26|üîç Expansi√≥n de consulta web: 'qui√©nes somos quienes somos qui√©nes somos ajover darnel'
2025-08-17 14:50:06|INFO    |140291|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'qui√©nes somos quienes somos qui√©nes somos ajover d...' (top_k=20)
2025-08-17 14:50:06|DEBUG   |140291|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=55)
2025-08-17 14:50:06|DEBUG   |140291|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+23.89 en 23.89s)
2025-08-17 14:50:06|DEBUG   |140291|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 14:50:06|DEBUG   |140291|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 14:50:06|INFO    |140291|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 14:50:07|SUCCESS |140291|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 14:50:07|SUCCESS |140291|backend.src.orchestrator.tools.web_content.tool_web_search:129|üü¶ Web docs encontrados: 20
2025-08-17 14:50:07|DEBUG   |140291|backend.src.orchestrator.tools.web_content.tool_web_search:130|üîµ Raw web preview: [{'source': 'sostenibilidad', 'content': 'En Ajover Darnel S.A.S. estamos comprometidos con la soste...
2025-08-17 14:50:07|DEBUG   |140291|backend.src.orchestrator.tools.web_content._format_web_search_results:91|üîµ Formateados 20 docs web.
2025-08-17 14:50:07|INFO    |140291|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'match'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}]
2025-08-17 14:50:07|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:50:09|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Ajover Darnel S.A.S. es una compa√±√≠a colombiana co‚Ä¶'
2025-08-17 14:50:09|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'match'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}]
2025-08-17 14:50:09|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:50:09.671046-05:00
2025-08-17 14:50:09|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:50:09.761740-05:00
2025-08-17 14:50:09|SUCCESS |140291|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_dcadb90e2a06faa7beb96b8acbe484e0
2025-08-17 14:50:09|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 8085.02ms)
2025-08-17 14:50:54|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:50:54|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 14:50:54|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 14:50:54|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:50:54|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:50:54|INFO    |140291|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 14:50:54|DEBUG   |140291|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='session_id', query='cual es la misi√≥n de ajover?'
2025-08-17 14:50:54|DEBUG   |140291|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: session_id
2025-08-17 14:50:54|ERROR   |140291|backend.src.routers.chat.process_user_query:78|‚ùå Error fatal gestionando la sesi√≥n de usuario.
Traceback (most recent call last):

  File "/usr/lib/azure-functions-core-tools/workers/python/3.11/LINUX/X64/worker.py", line 71, in <module>
    main.main()
    ‚îÇ    ‚îî <function main at 0x7f88fa3640e0>
    ‚îî <module 'azure_functions_worker.main' from '/usr/lib/azure-functions-core-tools/workers/python/3.11/LINUX/X64/azure_functions...

  File "/usr/lib/azure-functions-core-tools/workers/python/3.11/LINUX/X64/azure_functions_worker/main.py", line 61, in main
    return asyncio.run(start_async(
           ‚îÇ       ‚îÇ   ‚îî <function start_async at 0x7f88fa367740>
           ‚îÇ       ‚îî <function _patch_asyncio.<locals>.run at 0x7f88f06a4400>
           ‚îî <module 'asyncio' from '/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/__init__.py'>

  File "/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ‚îÇ      ‚îÇ   ‚îî <coroutine object start_async at 0x7f88f9f85140>
           ‚îÇ      ‚îî <function Runner.run at 0x7f88f9f1b880>
           ‚îî <asyncio.runners.Runner object at 0x7f88fa09b410>
  File "/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ‚îÇ    ‚îÇ     ‚îÇ                  ‚îî <Task pending name='Task-1' coro=<start_async() running at /usr/lib/azure-functions-core-tools/workers/python/3.11/LINUX/X64/...
           ‚îÇ    ‚îÇ     ‚îî <function _patch_loop.<locals>.run_until_complete at 0x7f88ba51c2c0>
           ‚îÇ    ‚îî <_UnixSelectorEventLoop running=True closed=False debug=False>
           ‚îî <asyncio.runners.Runner object at 0x7f88fa09b410>
  File "/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
    ‚îÇ    ‚îî <function _patch_loop.<locals>.run_forever at 0x7f88ba51c220>
    ‚îî <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
    ‚îÇ    ‚îî <function _patch_loop.<locals>._run_once at 0x7f88ba51c360>
    ‚îî <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/nest_asyncio.py", line 133, in _run_once
    handle._run()
    ‚îÇ      ‚îî <function Handle._run at 0x7f88fa0ab560>
    ‚îî <Handle ContextEnabledTask.task_wakeup(<Future finished result=None>)>
  File "/home/lynn/.local/share/uv/python/cpython-3.11.12-linux-x86_64-gnu/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
    ‚îÇ    ‚îÇ            ‚îÇ    ‚îÇ           ‚îÇ    ‚îî <member '_args' of 'Handle' objects>
    ‚îÇ    ‚îÇ            ‚îÇ    ‚îÇ           ‚îî <Handle ContextEnabledTask.task_wakeup(<Future finished result=None>)>
    ‚îÇ    ‚îÇ            ‚îÇ    ‚îî <member '_callback' of 'Handle' objects>
    ‚îÇ    ‚îÇ            ‚îî <Handle ContextEnabledTask.task_wakeup(<Future finished result=None>)>
    ‚îÇ    ‚îî <member '_context' of 'Handle' objects>
    ‚îî <Handle ContextEnabledTask.task_wakeup(<Future finished result=None>)>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          ‚îÇ    ‚îÇ   ‚îÇ      ‚îÇ                      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f88b9619a80>
          ‚îÇ    ‚îÇ   ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ    ‚îÇ   ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ    ‚îî <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f88b9f85e50>
          ‚îî <backend.src.core.policies.SecurityPoliciesMiddleware object at 0x7f88b9fb1910>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          ‚îÇ                            ‚îÇ    ‚îÇ    ‚îÇ     ‚îÇ      ‚îÇ        ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f88b9619a80>
          ‚îÇ                            ‚îÇ    ‚îÇ    ‚îÇ     ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ                            ‚îÇ    ‚îÇ    ‚îÇ     ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ                            ‚îÇ    ‚îÇ    ‚îî <starlette.requests.Request object at 0x7f88b963b5d0>
          ‚îÇ                            ‚îÇ    ‚îî <fastapi.routing.APIRouter object at 0x7f88ba6842d0>
          ‚îÇ                            ‚îî <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f88b9f85e50>
          ‚îî <function wrap_app_handling_exceptions at 0x7f88d815ec00>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          ‚îÇ   ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619760>
          ‚îÇ   ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ   ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îî <fastapi.routing.APIRouter object at 0x7f88ba6842d0>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          ‚îÇ    ‚îÇ                ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619760>
          ‚îÇ    ‚îÇ                ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ    ‚îÇ                ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ    ‚îî <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f88ba6842d0>>
          ‚îî <fastapi.routing.APIRouter object at 0x7f88ba6842d0>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          ‚îÇ     ‚îÇ      ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619760>
          ‚îÇ     ‚îÇ      ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ     ‚îÇ      ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ     ‚îî <function Route.handle at 0x7f88d818c180>
          ‚îî APIRoute(path='/chat/query', name='process_user_query', methods=['POST'])
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          ‚îÇ    ‚îÇ   ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619760>
          ‚îÇ    ‚îÇ   ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ    ‚îÇ   ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ    ‚îî <function request_response.<locals>.app at 0x7f88ba4f67a0>
          ‚îî APIRoute(path='/chat/query', name='process_user_query', methods=['POST'])
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          ‚îÇ                            ‚îÇ    ‚îÇ        ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619760>
          ‚îÇ                            ‚îÇ    ‚îÇ        ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ                            ‚îÇ    ‚îÇ        ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îÇ                            ‚îÇ    ‚îî <starlette.requests.Request object at 0x7f88b955b610>
          ‚îÇ                            ‚îî <function request_response.<locals>.app.<locals>.app at 0x7f88b9619e40>
          ‚îî <function wrap_app_handling_exceptions at 0x7f88d815ec00>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          ‚îÇ   ‚îÇ      ‚îÇ        ‚îî <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f88b9619c60>
          ‚îÇ   ‚îÇ      ‚îî <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f88b9551d00>
          ‚îÇ   ‚îî {'type': 'http', 'asgi.version': '2.1', 'asgi.spec_version': '2.1', 'http_version': '1.1', 'method': 'POST', 'scheme': 'http'...
          ‚îî <function request_response.<locals>.app.<locals>.app at 0x7f88b9619e40>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     ‚îÇ ‚îî <starlette.requests.Request object at 0x7f88b955b610>
                     ‚îî <function get_request_handler.<locals>.app at 0x7f88ba4f6980>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         ‚îî <function run_endpoint_function at 0x7f88fa3a1800>
  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 ‚îÇ         ‚îÇ      ‚îî {'agent': <backend.src.orchestrator.settings.agent_settings.AjoverAgent object at 0x7f88ba6791d0>, 'session_manager': <backen...
                 ‚îÇ         ‚îî <function process_user_query at 0x7f88ba4a0220>
                 ‚îî Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

> File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/backend/src/routers/chat.py", line 70, in process_user_query
    session = await session_manager.get_session(request.session_id)
                    ‚îÇ               ‚îÇ           ‚îÇ       ‚îî 'session_id'
                    ‚îÇ               ‚îÇ           ‚îî BaseQueryRequest(query='cual es la misi√≥n de ajover?', session_id='session_id', chat_history=[{'role': 'user', 'content': '',...
                    ‚îÇ               ‚îî <function CosmosDBSessions.get_session at 0x7f88bb7bb7e0>
                    ‚îî <backend.src.infrastructure.cosmos_db_sessions.CosmosDBSessions object at 0x7f88b9f92f90>

  File "/home/lynn/Documentos/development/scripts-notebooks/professional-projects/ajover/backend/src/infrastructure/cosmos_db_sessions.py", line 168, in get_session
    raise ValueError(f'session_id inv√°lido: {session_id}')

ValueError: session_id inv√°lido: session_id
2025-08-17 14:50:54|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 500 (tard√≥ 12.42ms)
2025-08-17 14:51:05|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:51:05|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 14:51:05|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 14:51:05|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:51:05|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:51:05|INFO    |140291|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 14:51:05|DEBUG   |140291|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cual es la misi√≥n de ajover?'
2025-08-17 14:51:05|INFO    |140291|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 14:51:05|SUCCESS |140291|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:05|SUCCESS |140291|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:05|DEBUG   |140291|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:05|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:05.567235-05:00
2025-08-17 14:51:05|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:05|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 14:51:05|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cual es la misi√≥n de ajover?‚Ä¶'
2025-08-17 14:51:05|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:51:06|DEBUG   |140291|backend.src.orchestrator.tools.web_content.tool_web_search:115|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 14:51:06|DEBUG   |140291|backend.src.orchestrator.tools.web_content._expand_query_if_needed:26|üîç Expansi√≥n de consulta web: 'misi√≥n de Ajover mision misi√≥n proposito prop√≥sito'
2025-08-17 14:51:06|INFO    |140291|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'misi√≥n de Ajover mision misi√≥n proposito prop√≥sito...' (top_k=20)
2025-08-17 14:51:06|DEBUG   |140291|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=50)
2025-08-17 14:51:06|DEBUG   |140291|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+60.37 en 60.37s)
2025-08-17 14:51:06|DEBUG   |140291|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 14:51:06|DEBUG   |140291|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 14:51:06|INFO    |140291|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 14:51:07|SUCCESS |140291|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 14:51:07|SUCCESS |140291|backend.src.orchestrator.tools.web_content.tool_web_search:129|üü¶ Web docs encontrados: 20
2025-08-17 14:51:07|DEBUG   |140291|backend.src.orchestrator.tools.web_content.tool_web_search:130|üîµ Raw web preview: [{'source': 'sobre_ajover', 'content': 'Queremos que seas parte de la gran familia Ajover, por eso t...
2025-08-17 14:51:07|DEBUG   |140291|backend.src.orchestrator.tools.web_content._format_web_search_results:91|üîµ Formateados 20 docs web.
2025-08-17 14:51:07|INFO    |140291|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'match'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}]
2025-08-17 14:51:07|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:51:08|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'La misi√≥n de Ajover es impulsar proyectos sostenib‚Ä¶'
2025-08-17 14:51:08|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'match'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}]
2025-08-17 14:51:08|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:08.962171-05:00
2025-08-17 14:51:09|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:09.042529-05:00
2025-08-17 14:51:09|SUCCESS |140291|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:09|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 3560.07ms)
2025-08-17 14:51:48|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:51:48|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 14:51:48|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 14:51:48|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:51:48|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:51:48|INFO    |140291|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 14:51:48|DEBUG   |140291|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_02ee5d8606de6d5dbd82fdf90ab17c1f', query='que tipos de productos tiene ajover?'
2025-08-17 14:51:48|DEBUG   |140291|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:48|DEBUG   |140291|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:48|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:48.799366-05:00
2025-08-17 14:51:48|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (2 mensajes)
2025-08-17 14:51:48|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (2 mensajes)
2025-08-17 14:51:48|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'que tipos de productos tiene ajover?‚Ä¶'
2025-08-17 14:51:48|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:51:56|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Ajover ofrece los siguientes tipos de productos, o‚Ä¶'
2025-08-17 14:51:56|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-17 14:51:56|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:56.348195-05:00
2025-08-17 14:51:56|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:51:56.438779-05:00
2025-08-17 14:51:56|SUCCESS |140291|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:51:56|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 7732.08ms)
2025-08-17 14:52:22|INFO    |140291|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 14:52:22|INFO    |140291|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 14:52:22|INFO    |140291|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 14:52:22|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:52:22|DEBUG   |140291|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 14:52:22|INFO    |140291|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 14:52:22|DEBUG   |140291|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='sess_02ee5d8606de6d5dbd82fdf90ab17c1f', query='me gustar√≠a tener la informaci√≥n de tejas de pvc'
2025-08-17 14:52:22|DEBUG   |140291|backend.src.routers.chat.process_user_query:69|Buscando sesi√≥n existente: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:52:22|DEBUG   |140291|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:52:22|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:52:22.943122-05:00
2025-08-17 14:52:23|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (4 mensajes)
2025-08-17 14:52:23|DEBUG   |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (4 mensajes)
2025-08-17 14:52:23|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'me gustar√≠a tener la informaci√≥n de tejas de pvc‚Ä¶'
2025-08-17 14:52:23|INFO    |140291|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 14:52:24|SUCCESS |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'En la categor√≠a **Tejas PVC**, Ajover ofrece las s‚Ä¶'
2025-08-17 14:52:24|INFO    |140291|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): []
2025-08-17 14:52:24|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:52:24.663144-05:00
2025-08-17 14:52:24|DEBUG   |140291|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T14:52:24.744051-05:00
2025-08-17 14:52:24|SUCCESS |140291|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_02ee5d8606de6d5dbd82fdf90ab17c1f
2025-08-17 14:52:24|INFO    |140291|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1882.89ms)
2025-08-17 15:01:18|INFO    |144815|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:28|Inicializando configuraci√≥n de logging.
2025-08-17 15:01:18|DEBUG   |144815|backend.src.app.<module>:30|ENTORNO AZURE FUNCTIONS: python
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:46|Instancia de FastAPI creada: title='Ajover Chatbot API', version='1.0.0'.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:53|Configurando logging de endpoints.
2025-08-17 15:01:18|INFO    |144815|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 15:01:18|INFO    |144815|backend.src.core.logging_config.endpoints_logging:115|üîß App logger configurado con PropagateHandler.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:55|Configuraci√≥n de logging de endpoints completada.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:60|Configurando documentaci√≥n.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.core.openapi.documentation_config:63|Funci√≥n custom_openapi instalada en app.openapi con base relativa '%s'.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:62|Configuraci√≥n de documentaci√≥n completada.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:67|Configurando pol√≠ticas de seguridad.
2025-08-17 15:01:18|INFO    |144815|backend.src.core.policies.add_security_middleware:87|üè≠ Applying security middleware...
2025-08-17 15:01:18|INFO    |144815|backend.src.core.policies.add_security_middleware:94|‚úÖ Pol√≠ticas de seguridad aplicadas.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:69|Configuraci√≥n de pol√≠ticas de seguridad completada.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:74|Registrando middleware CORS.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:82|Middleware CORS registrado.
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:87|Incluyendo routers.
2025-08-17 15:01:18|SUCCESS |144815|backend.src.app.<module>:92|üîå ROUTERS REGISTRADOS CORRECTAMENTE. Endpoints disponibles: [Route(path='/openapi.json', name='openapi', methods=['GET', 'HEAD']), APIRoute(path='/', name='api_root', methods=['GET']), APIRoute(path='/docs', name='get_scalar_docs', methods=['GET']), APIRoute(path='/health', name='health_check', methods=['GET']), APIRoute(path='/chat/query', name='process_user_query', methods=['POST']), APIRoute(path='/sessions/', name='create_new_session', methods=['POST']), APIRoute(path='/sessions/{session_id}', name='get_session_by_id', methods=['GET']), APIRoute(path='/sessions/{session_id}/history', name='clear_history', methods=['DELETE']), APIRoute(path='/users/', name='register_user', methods=['POST']), APIRoute(path='/users/{user_id}', name='get_user_by_id', methods=['GET'])]
2025-08-17 15:01:18|INFO    |144815|backend.src.app.<module>:99|Aplicaci√≥n FastAPI lista. Esperando peticiones...
2025-08-17 15:01:18|INFO    |144815|backend.src.core.logging_config.setup_logging:82|‚úÖ Logger de Loguru configurado.
2025-08-17 15:01:18|INFO    |144815|function_app.<module>:27|üöÄ Inicializando agente en el arranque de FunctionApp...
2025-08-17 15:01:18|INFO    |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:46|üîß Creando instancia del agente...
2025-08-17 15:01:18|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:55|‚è≥ Loading SearchAI‚Ä¶ (pdf=pdf-index-v2, web=web-index-v2)
2025-08-17 15:01:18|DEBUG   |144815|backend.src.infrastructure.openai.create:71|üîß Iniciando OpenAI.create()
2025-08-17 15:01:18|DEBUG   |144815|backend.src.infrastructure.openai._ensure_settings:60|üîç Validando configuraci√≥n de OpenAI
2025-08-17 15:01:18|DEBUG   |144815|backend.src.infrastructure.openai.create:77|üîë Configuraci√≥n de API key y endpoint encontrada
2025-08-17 15:01:19|SUCCESS |144815|backend.src.infrastructure.openai.create:86|ü§ñ‚úÖ Cliente AsyncAzureOpenAI inicializado
2025-08-17 15:01:19|DEBUG   |144815|backend.src.infrastructure.openai.__init__:45|üöÄ Inicializando servicio OpenAI: chat='gpt-4o', embeddings='text-embedding-3-small', temp=0.0
2025-08-17 15:01:19|INFO    |144815|backend.src.utils.time_utils.__init__:155|ü™£ Token bucket 'default' inicializado: rate=1.0/s, capacity=5
2025-08-17 15:01:19|DEBUG   |144815|backend.src.infrastructure.openai.__init__:54|‚úÖ Servicio OpenAI inicializado correctamente
2025-08-17 15:01:19|SUCCESS |144815|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'pdf-index-v2'.
2025-08-17 15:01:19|DEBUG   |144815|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'pdf-index-v2' asignados.
2025-08-17 15:01:19|SUCCESS |144815|backend.src.infrastructure.infrastructure.create_searchai:123|üîó‚úÖ SearchAI inicializado para √≠ndice 'pdf-index-v2' (pdf).
2025-08-17 15:01:19|SUCCESS |144815|backend.src.infrastructure.searchai.create:77|üîó‚úÖ Clientes de Azure Search AI inicializados para √≠ndice 'web-index-v2'.
2025-08-17 15:01:19|DEBUG   |144815|backend.src.infrastructure.searchai.__init__:56|Clientes de Search AI para √≠ndice 'web-index-v2' asignados.
2025-08-17 15:01:19|SUCCESS |144815|backend.src.infrastructure.infrastructure.create_searchai:123|üîó‚úÖ SearchAI inicializado para √≠ndice 'web-index-v2' (web).
2025-08-17 15:01:19|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:60|‚úÖ SearchAI listos (PDF='pdf-index-v2', WEB='web-index-v2')
2025-08-17 15:01:19|INFO    |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:64|ü§ñ Inicializando AzureChatOpenAI‚Ä¶
2025-08-17 15:01:19|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:73|‚úÖ Modelo AzureChatOpenAI listo.
2025-08-17 15:01:19|INFO    |144815|backend.src.orchestrator.settings.agent_settings.__init__:49|ü§ñ Inicializando el agente con dependencias inyectadas...
2025-08-17 15:01:19|SUCCESS |144815|backend.src.orchestrator.settings.agent_settings.__init__:56|‚úÖ Agente y grafo compilados con √©xito.
2025-08-17 15:01:19|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:83|üöÄ Agente listo para solicitudes.
2025-08-17 15:01:19|INFO    |144815|function_app.<module>:29|ü§ñ Agente inicializado correctamente.
2025-08-17 15:01:19|INFO    |144815|function_app.<module>:31|üöÄ FunctionApp cargada correctamente.
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/docs
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /docs
2025-08-17 15:01:20|INFO    |144815|backend.src.routers.meta.get_scalar_docs:88|‚Üí Llamada a get_scalar_docs
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.52ms)
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-17 15:01:20|DEBUG   |144815|backend.src.core.openapi.custom_openapi:45|Generando esquema OpenAPI...
2025-08-17 15:01:20|INFO    |144815|backend.src.core.openapi.custom_openapi:54|OpenAPI.servers configurado a url=''.
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 5.99ms)
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:20|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: GET http://localhost:7071/openapi.json
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: GET /openapi.json
2025-08-17 15:01:20|DEBUG   |144815|backend.src.core.openapi.custom_openapi:42|Reutilizando esquema OpenAPI existente.
2025-08-17 15:01:20|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 0.57ms)
2025-08-17 15:01:30|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:30|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:01:30|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:01:30|WARNING |144815|backend.src.core.warm_up.ensure_warm_state:103|‚ö†Ô∏è  Startup no corri√≥ ‚Üí ejecutando lazy warm-up
2025-08-17 15:01:30|INFO    |144815|backend.src.core.warm_up.warm_up_app:41|ü§ñ Warm-up: inicializando agente‚Ä¶
2025-08-17 15:01:30|INFO    |144815|backend.src.orchestrator.settings.agent_factory.initialize_agent:43|‚úÖ El agente ya estaba inicializado. Saltando creaci√≥n.
2025-08-17 15:01:30|INFO    |144815|backend.src.core.warm_up.warm_up_app:49|üîå Warm-up: creando conexiones externas‚Ä¶
2025-08-17 15:01:30|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create:104|üîó‚úÖ CosmosDBSessions listo (DB='ajover-chatbot-db', Coll='session-collection').
2025-08-17 15:01:30|SUCCESS |144815|backend.src.infrastructure.cosmos_db_users.create:97|üîó‚úÖ CosmosDBUsers listo (DB='ajover-chatbot-db', Coll='users-collection').
2025-08-17 15:01:30|DEBUG   |144815|backend.src.infrastructure.blob_storage.create:44|Iniciando m√©todo de f√°brica BlobStorage.create().
2025-08-17 15:01:30|INFO    |144815|backend.src.infrastructure.blob_storage.create:63|üì¶‚úÖ Contenedor 'documentos-pdf' ya existe, se usar√° el existente.
2025-08-17 15:01:30|SUCCESS |144815|backend.src.infrastructure.blob_storage.create:68|üîó‚úÖ BlobServiceClient inicializado para el contenedor 'documentos-pdf'.
2025-08-17 15:01:30|DEBUG   |144815|backend.src.infrastructure.blob_storage.__init__:35|Inicializando BlobStorage con contenedor: 'documentos-pdf'.
2025-08-17 15:01:30|SUCCESS |144815|backend.src.core.warm_up.warm_up_app:81|‚úÖ Warm-up completo.
2025-08-17 15:01:30|SUCCESS |144815|backend.src.core.warm_up.ensure_warm_state:109|‚úÖ Lazy warm-up completado.
2025-08-17 15:01:30|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:01:30|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:01:30|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cual es la mision de ajover?'
2025-08-17 15:01:30|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:01:32|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_9139d8d30718493b36ec783b74bdc24c
2025-08-17 15:01:32|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_9139d8d30718493b36ec783b74bdc24c
2025-08-17 15:01:32|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_9139d8d30718493b36ec783b74bdc24c
2025-08-17 15:01:32|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:32.652836-05:00
2025-08-17 15:01:32|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_9139d8d30718493b36ec783b74bdc24c
2025-08-17 15:01:33|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:01:33|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cual es la mision de ajover?‚Ä¶'
2025-08-17 15:01:33|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:34|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:01:34|DEBUG   |144815|backend.src.orchestrator.tools.web_content._expand_query_if_needed:49|üîç Expansi√≥n de consulta web: 'mision de ajover mision misi√≥n proposito prop√≥sito raz√≥n de ser'
2025-08-17 15:01:34|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'mision de ajover mision misi√≥n proposito prop√≥sito...' (top_k=20)
2025-08-17 15:01:34|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=63)
2025-08-17 15:01:34|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 5.00 ‚Üí 5.00 tokens (+15.65 en 15.65s)
2025-08-17 15:01:34|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:01:34|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:01:35|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:01:35|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 15:01:35|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 20
2025-08-17 15:01:35|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'construccion_sostenible', 'id': '58b9df79a88bfd4ce75a5aa4ddf46501b1...
2025-08-17 15:01:35|DEBUG   |144815|backend.src.orchestrator.tools.web_content._rerank_web_results:178|üèÅ Rerank web TOP5: [{'title': 'Misi√≥n', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 42.0}, {'title': '¬°S√© parte del equipo Ajover!', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Copyright', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Visi√≥n', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': '¬°Una alianza estrat√©gica!', 'source': 'construccion_sostenible', 'url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible', 'score': 6.0}]
2025-08-17 15:01:35|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 20 docs web.
2025-08-17 15:01:35|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:35|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:37|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'La misi√≥n de Ajover es ofrecer a sus clientes prod‚Ä¶'
2025-08-17 15:01:37|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:37|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:37.603281-05:00
2025-08-17 15:01:37|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:37.695080-05:00
2025-08-17 15:01:37|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_9139d8d30718493b36ec783b74bdc24c
2025-08-17 15:01:37|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 7560.09ms)
2025-08-17 15:01:50|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:50|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:01:50|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:01:50|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:01:50|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:01:50|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:01:50|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cual es la visi√≥n de ajover?'
2025-08-17 15:01:50|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:01:50|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_37976839a7067642447d399a31342e78
2025-08-17 15:01:50|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_37976839a7067642447d399a31342e78
2025-08-17 15:01:50|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_37976839a7067642447d399a31342e78
2025-08-17 15:01:50|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:50.146235-05:00
2025-08-17 15:01:50|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (1 mensajes)
2025-08-17 15:01:50|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (1 mensajes)
2025-08-17 15:01:50|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cual es la visi√≥n de ajover?‚Ä¶'
2025-08-17 15:01:50|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:51|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:01:51|DEBUG   |144815|backend.src.orchestrator.tools.web_content._expand_query_if_needed:49|üîç Expansi√≥n de consulta web: 'visi√≥n de Ajover futuro vision visi√≥n'
2025-08-17 15:01:51|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'visi√≥n de Ajover futuro vision visi√≥n...' (top_k=20)
2025-08-17 15:01:51|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=37)
2025-08-17 15:01:51|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+16.42 en 16.42s)
2025-08-17 15:01:51|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:01:51|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:01:51|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:01:52|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 15:01:52|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 20
2025-08-17 15:01:52|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': '9560906da23277752d688065d663b250a5d8dd15', 's...
2025-08-17 15:01:52|DEBUG   |144815|backend.src.orchestrator.tools.web_content._rerank_web_results:178|üèÅ Rerank web TOP5: [{'title': 'Copyright', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': '¬°S√© parte del equipo Ajover!', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Productos', 'source': 'noticias', 'url': 'https://www.ajover.com/noticias', 'score': 6.0}, {'title': '¬°Apoyamos a nuestras comunidades!', 'source': 'sostenibilidad', 'url': 'https://www.ajover.com/sostenibilidad', 'score': 0.0}, {'title': 'Cierra la venta mostrando un ejemplo de c√≥mo se ver√≠a el proyecto de tu cliente', 'source': 'aumentar_ventas', 'url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica', 'score': 0.0}]
2025-08-17 15:01:52|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 20 docs web.
2025-08-17 15:01:52|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:52|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:52|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'No puedo confirmar esta informaci√≥n con la fuente ‚Ä¶'
2025-08-17 15:01:52|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:52|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:52.813447-05:00
2025-08-17 15:01:52|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:52.894639-05:00
2025-08-17 15:01:52|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_37976839a7067642447d399a31342e78
2025-08-17 15:01:52|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2833.61ms)
2025-08-17 15:01:57|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:01:57|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:01:57|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:01:57|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:01:57|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:01:57|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:01:57|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cual es la vision de ajover?'
2025-08-17 15:01:57|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:01:57|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_3ecb5ec93a555144d21b08df28c1e26a
2025-08-17 15:01:57|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_3ecb5ec93a555144d21b08df28c1e26a
2025-08-17 15:01:57|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_3ecb5ec93a555144d21b08df28c1e26a
2025-08-17 15:01:57|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:57.556899-05:00
2025-08-17 15:01:57|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (1 mensajes)
2025-08-17 15:01:57|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (1 mensajes)
2025-08-17 15:01:57|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cual es la vision de ajover?‚Ä¶'
2025-08-17 15:01:57|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:58|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:01:58|DEBUG   |144815|backend.src.orchestrator.tools.web_content._expand_query_if_needed:49|üîç Expansi√≥n de consulta web: 'visi√≥n de Ajover futuro vision visi√≥n'
2025-08-17 15:01:58|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'visi√≥n de Ajover futuro vision visi√≥n...' (top_k=20)
2025-08-17 15:01:58|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=37)
2025-08-17 15:01:58|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+7.05 en 7.05s)
2025-08-17 15:01:58|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:01:58|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:01:58|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:01:58|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 15:01:58|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 20
2025-08-17 15:01:58|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': '9560906da23277752d688065d663b250a5d8dd15', 's...
2025-08-17 15:01:58|DEBUG   |144815|backend.src.orchestrator.tools.web_content._rerank_web_results:178|üèÅ Rerank web TOP5: [{'title': 'Copyright', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': '¬°S√© parte del equipo Ajover!', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Productos', 'source': 'noticias', 'url': 'https://www.ajover.com/noticias', 'score': 6.0}, {'title': '¬°Apoyamos a nuestras comunidades!', 'source': 'sostenibilidad', 'url': 'https://www.ajover.com/sostenibilidad', 'score': 0.0}, {'title': 'Cierra la venta mostrando un ejemplo de c√≥mo se ver√≠a el proyecto de tu cliente', 'source': 'aumentar_ventas', 'url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica', 'score': 0.0}]
2025-08-17 15:01:58|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 20 docs web.
2025-08-17 15:01:58|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:58|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:01:59|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'No puedo confirmar esta informaci√≥n con la fuente ‚Ä¶'
2025-08-17 15:01:59|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:01:59|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:59.355507-05:00
2025-08-17 15:01:59|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:01:59.435791-05:00
2025-08-17 15:01:59|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_3ecb5ec93a555144d21b08df28c1e26a
2025-08-17 15:01:59|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 1963.42ms)
2025-08-17 15:02:10|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:02:10|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:02:10|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:02:10|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:10|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:10|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:02:10|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cual es la misi√≥n de ajover?'
2025-08-17 15:02:10|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:02:10|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_5446e20ac580f6d008a83cd0c1cf759d
2025-08-17 15:02:10|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_5446e20ac580f6d008a83cd0c1cf759d
2025-08-17 15:02:10|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_5446e20ac580f6d008a83cd0c1cf759d
2025-08-17 15:02:10|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:10.781547-05:00
2025-08-17 15:02:10|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_5446e20ac580f6d008a83cd0c1cf759d
2025-08-17 15:02:10|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:02:10|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cual es la misi√≥n de ajover?‚Ä¶'
2025-08-17 15:02:10|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:11|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:02:11|DEBUG   |144815|backend.src.orchestrator.tools.web_content._expand_query_if_needed:49|üîç Expansi√≥n de consulta web: 'misi√≥n de Ajover mision misi√≥n proposito prop√≥sito raz√≥n de ser'
2025-08-17 15:02:11|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'misi√≥n de Ajover mision misi√≥n proposito prop√≥sito...' (top_k=20)
2025-08-17 15:02:11|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=63)
2025-08-17 15:02:11|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+13.66 en 13.66s)
2025-08-17 15:02:11|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:02:11|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:02:12|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:02:12|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 20 resultados.
2025-08-17 15:02:12|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 20
2025-08-17 15:02:12|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': 'ca333fe9d1d1a7b9171aa5f051237c9400d64353', 's...
2025-08-17 15:02:12|DEBUG   |144815|backend.src.orchestrator.tools.web_content._rerank_web_results:178|üèÅ Rerank web TOP5: [{'title': 'Misi√≥n', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 42.0}, {'title': '¬°S√© parte del equipo Ajover!', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Copyright', 'source': 'sobre_ajover', 'url': 'https://www.ajover.com/sobre-ajover', 'score': 12.0}, {'title': 'Un compromiso con la construcci√≥n sostenible', 'source': 'construccion_sostenible', 'url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible', 'score': 3.0}, {'title': 'Productos', 'source': 'noticias', 'url': 'https://www.ajover.com/noticias', 'score': 3.0}]
2025-08-17 15:02:12|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 20 docs web.
2025-08-17 15:02:12|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:12|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:14|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'La misi√≥n de Ajover es ofrecer a sus clientes prod‚Ä¶'
2025-08-17 15:02:14|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'match'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/crea-match-perfectos-con-la-mejor-calidad-ajover'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:14|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:14.997652-05:00
2025-08-17 15:02:15|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:15.078166-05:00
2025-08-17 15:02:15|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_5446e20ac580f6d008a83cd0c1cf759d
2025-08-17 15:02:15|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4381.48ms)
2025-08-17 15:02:28|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:02:28|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:02:28|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:02:28|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:28|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:28|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:02:28|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cuales son las plantas de ajover?'
2025-08-17 15:02:28|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:02:28|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_5700adeb38a28db1c55414651f9d9ee9
2025-08-17 15:02:28|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_5700adeb38a28db1c55414651f9d9ee9
2025-08-17 15:02:28|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_5700adeb38a28db1c55414651f9d9ee9
2025-08-17 15:02:28|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:28.477452-05:00
2025-08-17 15:02:28|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:140|üìú Historial convertido (1 mensajes)
2025-08-17 15:02:28|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (1 mensajes)
2025-08-17 15:02:28|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cuales son las plantas de ajover?‚Ä¶'
2025-08-17 15:02:28|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:29|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:02:29|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'plantas de Ajover...' (top_k=10)
2025-08-17 15:02:29|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=17)
2025-08-17 15:02:29|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+17.63 en 17.63s)
2025-08-17 15:02:29|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:02:29|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:02:29|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:02:30|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-17 15:02:30|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 10
2025-08-17 15:02:30|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': '9560906da23277752d688065d663b250a5d8dd15', 's...
2025-08-17 15:02:30|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 10 docs web.
2025-08-17 15:02:30|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:30|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:31|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'No puedo confirmar informaci√≥n espec√≠fica sobre la‚Ä¶'
2025-08-17 15:02:31|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:31|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:31.261691-05:00
2025-08-17 15:02:31|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:31.342490-05:00
2025-08-17 15:02:31|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_5700adeb38a28db1c55414651f9d9ee9
2025-08-17 15:02:31|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2957.17ms)
2025-08-17 15:02:50|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:02:50|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:02:50|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:02:50|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:50|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:02:50|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:02:50|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cuales son las plantas de producci√≥n ajover?'
2025-08-17 15:02:50|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:02:50|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_0ef61609fce826217033462d4ba83f28
2025-08-17 15:02:50|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_0ef61609fce826217033462d4ba83f28
2025-08-17 15:02:50|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_0ef61609fce826217033462d4ba83f28
2025-08-17 15:02:50|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:50.571135-05:00
2025-08-17 15:02:50|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_0ef61609fce826217033462d4ba83f28
2025-08-17 15:02:50|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:02:50|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cuales son las plantas de producci√≥n ajover?‚Ä¶'
2025-08-17 15:02:50|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:51|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:02:51|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'plantas de producci√≥n Ajover...' (top_k=10)
2025-08-17 15:02:51|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=28)
2025-08-17 15:02:51|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+22.17 en 22.17s)
2025-08-17 15:02:51|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:02:51|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:02:51|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:02:52|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-17 15:02:52|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 10
2025-08-17 15:02:52|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': '9560906da23277752d688065d663b250a5d8dd15', 's...
2025-08-17 15:02:52|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 10 docs web.
2025-08-17 15:02:52|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:52|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:02:53|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'No puedo confirmar esta informaci√≥n con la fuente ‚Ä¶'
2025-08-17 15:02:53|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:02:53|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:53.043372-05:00
2025-08-17 15:02:53|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:02:53.124713-05:00
2025-08-17 15:02:53|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_0ef61609fce826217033462d4ba83f28
2025-08-17 15:02:53|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 2638.90ms)
2025-08-17 15:03:18|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:03:18|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:03:18|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:03:18|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:03:18|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:03:18|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:03:18|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='que ejemplos de proyectos tiene ajover?'
2025-08-17 15:03:18|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:03:18|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_1f89981c5cd0ed112b54fab530c70798
2025-08-17 15:03:18|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_1f89981c5cd0ed112b54fab530c70798
2025-08-17 15:03:18|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_1f89981c5cd0ed112b54fab530c70798
2025-08-17 15:03:18|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:03:18.184810-05:00
2025-08-17 15:03:18|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_1f89981c5cd0ed112b54fab530c70798
2025-08-17 15:03:18|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:03:18|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'que ejemplos de proyectos tiene ajover?‚Ä¶'
2025-08-17 15:03:18|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:03:19|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:03:19|DEBUG   |144815|backend.src.orchestrator.tools.web_content._expand_query_if_needed:49|üîç Expansi√≥n de consulta web: 'proyectos ajover casos de √©xito proyectos'
2025-08-17 15:03:19|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'proyectos ajover casos de √©xito proyectos...' (top_k=10)
2025-08-17 15:03:19|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=41)
2025-08-17 15:03:19|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+27.55 en 27.55s)
2025-08-17 15:03:19|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:03:19|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:03:19|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:03:20|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-17 15:03:20|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 10
2025-08-17 15:03:20|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'proyectos', 'id': '2bf5b96f1ff13a850e029ea588d1e092b2df684f', 'sour...
2025-08-17 15:03:20|DEBUG   |144815|backend.src.orchestrator.tools.web_content._rerank_web_results:178|üèÅ Rerank web TOP5: [{'title': 'Proyectos Ajover', 'source': 'proyectos', 'url': 'https://www.ajover.com/proyectos', 'score': 38.0}, {'title': 'Cierra la venta mostrando un ejemplo de c√≥mo se ver√≠a el proyecto de tu cliente', 'source': 'aumentar_ventas', 'url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica', 'score': 16.0}, {'title': 'Ajover se une al Consejo Colombiano de Construcci√≥n Sostenible', 'source': 'construccion_sostenible', 'url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible', 'score': 6.0}, {'title': 'Un compromiso con la construcci√≥n sostenible', 'source': 'construccion_sostenible', 'url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible', 'score': 6.0}, {'title': 'Dale un valor superior a la compra', 'source': 'aumentar_ventas', 'url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica', 'score': 3.0}]
2025-08-17 15:03:20|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 10 docs web.
2025-08-17 15:03:20|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:03:20|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:03:21|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Ajover presenta ejemplos de proyectos en los que s‚Ä¶'
2025-08-17 15:03:21|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:03:21|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:03:21.506831-05:00
2025-08-17 15:03:21|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:03:21.587316-05:00
2025-08-17 15:03:21|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_1f89981c5cd0ed112b54fab530c70798
2025-08-17 15:03:21|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 3486.73ms)
2025-08-17 15:04:35|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:04:35|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:04:35|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:04:35|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:04:35|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:04:35|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:04:35|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='en que lugares de colombia ajover tiene plantas?'
2025-08-17 15:04:35|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:04:35|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_19feff6c244abd8c6d5646f169afc70c
2025-08-17 15:04:35|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_19feff6c244abd8c6d5646f169afc70c
2025-08-17 15:04:35|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_19feff6c244abd8c6d5646f169afc70c
2025-08-17 15:04:35|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:04:35.813979-05:00
2025-08-17 15:04:35|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_19feff6c244abd8c6d5646f169afc70c
2025-08-17 15:04:35|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:04:35|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'en que lugares de colombia ajover tiene plantas?‚Ä¶'
2025-08-17 15:04:35|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:04:36|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:04:36|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'plantas de Ajover en Colombia...' (top_k=10)
2025-08-17 15:04:36|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=29)
2025-08-17 15:04:36|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+77.65 en 77.65s)
2025-08-17 15:04:36|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:04:36|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:04:37|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:04:37|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-17 15:04:37|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 10
2025-08-17 15:04:37|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'sobre_ajover', 'id': '828614ae47bd5e8d5a83c5cfca55fdbd35f95d66', 's...
2025-08-17 15:04:37|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 10 docs web.
2025-08-17 15:04:37|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:04:37|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:04:38|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Ajover tiene plantas en Colombia ubicadas en **Car‚Ä¶'
2025-08-17 15:04:38|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'renovar_espacios'}, {'source_domain': 'sostenibilidad'}, {'source_domain': 'gana_ajover'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'construccion_sostenible'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/gana-ajover'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/noticia/ajover-se-une-al-consejo-colombiano-de-construccion-sostenible'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:04:38|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:04:38.740119-05:00
2025-08-17 15:04:38|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:04:38.821200-05:00
2025-08-17 15:04:38|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_19feff6c244abd8c6d5646f169afc70c
2025-08-17 15:04:38|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 3092.34ms)
2025-08-17 15:04:59|INFO    |144815|function_app.http_function:64|üöÄ Handler personalizado cargado
2025-08-17 15:04:59|INFO    |144815|function_app.http_function:65|‚ö°Ô∏è HTTP Trigger: POST http://localhost:7071/chat/query
2025-08-17 15:04:59|INFO    |144815|backend.src.core.policies.dispatch:58|‚ñ∂Ô∏è Solicitud recibida: POST /chat/query
2025-08-17 15:04:59|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:04:59|DEBUG   |144815|backend.src.core.warm_up.ensure_warm_state:98|Warm-up ya realizado en Azure Functions. No es necesario repetirlo.
2025-08-17 15:04:59|INFO    |144815|backend.src.routers.chat.process_user_query:54|üì© Recibida nueva consulta al chat.
2025-08-17 15:04:59|DEBUG   |144815|backend.src.routers.chat.process_user_query:55|Payload recibido: session_id='', query='cuales son las novedades de ajover?'
2025-08-17 15:04:59|INFO    |144815|backend.src.routers.chat.process_user_query:73|Sesi√≥n no encontrada o no proporcionada. Creando nueva...
2025-08-17 15:04:59|SUCCESS |144815|backend.src.infrastructure.cosmos_db_sessions.create_session:151|üÜï Sesi√≥n creada id=sess_58b9992c8706a1d70da8a047d7093012
2025-08-17 15:04:59|SUCCESS |144815|backend.src.routers.chat.process_user_query:75|‚ú® Nueva sesi√≥n creada: sess_58b9992c8706a1d70da8a047d7093012
2025-08-17 15:04:59|DEBUG   |144815|backend.src.routers.chat.process_user_query:85|Invocando agente para sesi√≥n: sess_58b9992c8706a1d70da8a047d7093012
2025-08-17 15:04:59|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:04:59.420558-05:00
2025-08-17 15:04:59|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.get_persistent_chat_history:123|Historial vac√≠o para session_id=sess_58b9992c8706a1d70da8a047d7093012
2025-08-17 15:04:59|DEBUG   |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:178|üìö Historial para grafo (0 mensajes)
2025-08-17 15:04:59|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:185|‚ñ∂Ô∏è Invocando grafo con consulta: 'cuales son las novedades de ajover?‚Ä¶'
2025-08-17 15:04:59|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:05:00|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:239|üîµ [tool_web_search] Invocada (b√∫squeda web).
2025-08-17 15:05:00|INFO    |144815|backend.src.infrastructure.searchai.hybrid_search:210|üîéü§ñ B√∫squeda h√≠brida: 'noticias ajover...' (top_k=10)
2025-08-17 15:05:00|DEBUG   |144815|backend.src.infrastructure.openai.get_text_embedding:196|üìä Generando embedding para texto (len=15)
2025-08-17 15:05:00|DEBUG   |144815|backend.src.utils.time_utils._refill_tokens:211|üîÑ Bucket 'default' rellenado: 4.00 ‚Üí 5.00 tokens (+23.64 en 23.64s)
2025-08-17 15:05:00|DEBUG   |144815|backend.src.utils.time_utils.consume:194|ü™£ Consumidos 1 tokens del bucket 'default'. Tokens restantes: 4.00
2025-08-17 15:05:00|DEBUG   |144815|backend.src.infrastructure.openai.client:103|üîç Accediendo a cliente de OpenAI
2025-08-17 15:05:00|INFO    |144815|backend.src.infrastructure.openai.get_text_embedding:206|‚úÖ Embedding generado (dim=1536)
2025-08-17 15:05:01|SUCCESS |144815|backend.src.infrastructure.searchai.hybrid_search:236|üîç‚úÖ Se devolvieron 10 resultados.
2025-08-17 15:05:01|SUCCESS |144815|backend.src.orchestrator.tools.web_content.tool_web_search:259|üü¶ Web docs encontrados: 10
2025-08-17 15:05:01|DEBUG   |144815|backend.src.orchestrator.tools.web_content.tool_web_search:260|üîµ Raw web preview: [{'source': 'noticias', 'id': '031046bafe90ca1aa74c3cf0d84b826b9b4c7a13', 'sourc...
2025-08-17 15:05:01|DEBUG   |144815|backend.src.orchestrator.tools.web_content._format_web_search_results:210|üîµ Formateados 10 docs web.
2025-08-17 15:05:01|INFO    |144815|backend.src.orchestrator.settings.agent_settings._tools_node:166|üìö Fuentes extra√≠das (v√≠a Regex): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:05:01|INFO    |144815|backend.src.orchestrator.settings.agent_settings._agent_node:87|üß† Nodo Agente: Invocando al LLM...
2025-08-17 15:05:04|SUCCESS |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:191|‚úîÔ∏è Respuesta: 'Algunas de las novedades recientes de Ajover inclu‚Ä¶'
2025-08-17 15:05:04|INFO    |144815|backend.src.orchestrator.settings.agent_factory.invoke_agent:194|üìö Fuentes extra√≠das (controlado por backend): [{'source_domain': 'sostenibilidad'}, {'source_domain': 'renovar_espacios'}, {'source_domain': 'proyectos'}, {'source_domain': 'aumentar_ventas'}, {'source_domain': 'noticias'}, {'source_domain': 'sobre_ajover'}, {'source_url': 'https://www.ajover.com/sostenibilidad'}, {'source_url': 'https://www.ajover.com/noticia/renueva-los-espacios-y-que-tu-hogar-sea-tu-lugar-favorito'}, {'source_url': 'https://www.ajover.com/proyectos'}, {'source_url': 'https://www.ajover.com/noticias'}, {'source_url': 'https://www.ajover.com/noticia/aumenta-tus-ventas-con-nuestra-cubierta-termoacustica'}, {'source_url': 'https://www.ajover.com/sobre-ajover'}]
2025-08-17 15:05:04|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:05:04.023525-05:00
2025-08-17 15:05:04|DEBUG   |144815|backend.src.utils.time_utils.get_colombia_time:32|üïê Hora Colombia obtenida: 2025-08-17T15:05:04.103512-05:00
2025-08-17 15:05:04|SUCCESS |144815|backend.src.routers.chat.process_user_query:111|‚úÖ Respuesta construida exitosamente para la sesi√≥n sess_58b9992c8706a1d70da8a047d7093012
2025-08-17 15:05:04|INFO    |144815|backend.src.core.policies.dispatch:65|‚óÄÔ∏è Respuesta enviada: 200 (tard√≥ 4767.88ms)
